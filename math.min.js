/**
 * math.js
 * https://github.com/josdejong/mathjs
 *
 * Math.js is an extensive math library for JavaScript and Node.js,
 * It features real and complex numbers, units, matrices, a large set of
 * mathematical functions, and a flexible expression parser.
 *
 * @version 0.5.0-SNAPSHOT
 * @date    2013-03-24
 *
 * @license
 * Copyright (C) 2013 Jos de Jong <wjosdejong@gmail.com>
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy
 * of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */
(function(){function e(t,n){if(this.constructor!=e)throw new SyntaxError("Complex constructor must be called with the new operator");switch(arguments.length){case 2:if(!r(t)||!r(n))throw new TypeError("Two numbers or a single string expected in Complex constructor");this.re=t,this.im=n;break;case 1:if(!a(t))throw new TypeError("Two numbers or a single string expected in Complex constructor");var i=e.parse(t);if(i)return i;throw new SyntaxError('String "'+t+'" is no valid complex number');case 0:this.re=0,this.im=0;break;default:throw new SyntaxError("Wrong number of arguments in Complex constructor ("+arguments.length+" provided, 0, 1, or 2 expected)")}}function t(e){if(this.constructor!=t)throw new SyntaxError("Matrix constructor must be called with the new operator");this._data=e instanceof t||e instanceof s||e instanceof i?e.toArray():e instanceof Array?e:null!=e?[e]:[],this._size=At.size(this._data)}function r(e){return e instanceof Number||"number"==typeof e}function n(e){return e==Math.round(e)}function i(e,t,n){if(this.constructor!=i)throw new SyntaxError("Range constructor must be called with the new operator");if(null==n&&(n=t,t=null),2!=arguments.length&&3!=arguments.length)throw new TypeError("Wrong number of parameters in Range constructor (2 or 3 expected, "+arguments.length+" provided)");if(null!=e&&!r(e))throw new TypeError("Parameter start must be a number");if(null!=n&&!r(n))throw new TypeError("Parameter end must be a number");if(null!=t&&!r(t))throw new TypeError("Parameter step must be a number");this.start=null!=e?e:0,this.end=null!=n?n:0,this.step=null!=t?t:1}function a(e){return e instanceof String||"string"==typeof e}function o(e,t){if(this.constructor!=o)throw Error("Unit constructor must be called with the new operator");this.value=1,this.unit=o.UNIT_NONE,this.prefix=o.PREFIX_NONE,this.hasUnit=!1,this.hasValue=!1,this.fixPrefix=!1;var r=arguments.length;if(0==r);else{if(1==r){if(!a(e))throw new TypeError("A string or a number and string expected in Unit constructor");var n=o.parse(e);if(n)return n;throw new SyntaxError('String "'+e+'" is no valid unit')}if(2!=r)throw Error("Too many parameters in Unit constructor, 1 or 2 expected");if(!a(t))throw Error("Second parameter in Unit constructor must be a String");for(var i=o.UNITS,s=!1,f=0,u=i.length;u>f;f++){var c=i[f];if(o.endsWith(t,c.name)){var h=t.length-c.name.length,l=t.substring(0,h),p=c.prefixes[l];if(void 0!==p){this.unit=c,this.prefix=p,this.hasUnit=!0,s=!0;break}}}if(!s)throw Error('String "'+t+'" is no unit');null!=e?(this.value=this._normalize(e),this.hasValue=!0):this.value=this._normalize(1)}}function s(e){if(this.constructor!=s)throw new SyntaxError("Vector constructor must be called with the new operator");if(this._data=e instanceof t?e.toVector():e instanceof s||e instanceof i?e.toArray():e instanceof Array?e:null!=e?[e]:[],this._size=At.size(this._data),this._size.length>1)throw Error("Vector can only contain one dimension (size: "+ct(this._size)+")")}function f(e,t){var r=void 0;if(2==arguments.length){var n=vt(t);r="Function "+e+" does not support a parameter of type "+n}else if(arguments.length>2){for(var i=[],a=1;arguments.length>a;a++)i.push(vt(arguments[a]));r="Function "+e+" does not support a parameters of type "+i.join(", ")}else r="Unsupported parameter in function "+e;return new TypeError(r)}function u(e,t,r,n){var i="Wrong number of arguments in function "+e+" ("+t+" provided, "+r+(void 0!=n?"-"+n:"")+" expected)";return new SyntaxError(i)}function c(t){if(1!=arguments.length)throw u("abs",arguments.length,1);if(r(t))return Math.abs(t);if(t instanceof e)return Math.sqrt(t.re*t.re+t.im*t.im);if(t instanceof Array)return At.map(t,c);if(t.valueOf()!==t)return c(t.valueOf());throw f("abs",t)}function h(t,n){if(2!=arguments.length)throw u("add",arguments.length,2);if(r(t)){if(r(n))return t+n;if(n instanceof e)return new e(t+n.re,n.im)}else if(t instanceof e){if(r(n))return new e(t.re+n,t.im);if(n instanceof e)return new e(t.re+n.re,t.im+n.im)}else if(t instanceof o&&n instanceof o){if(!t.equalBase(n))throw Error("Units do not match");if(!t.hasValue)throw Error("Unit on left hand side of operator + has no value");if(!n.hasValue)throw Error("Unit on right hand side of operator + has no value");var i=t.clone();return i.value+=n.value,i.fixPrefix=!1,i}if(a(t)||a(n))return t+n;if(t instanceof Array||n instanceof Array)return At.map2(t,n,h);if(t.valueOf()!==t)return h(t.valueOf());throw f("add",t,n)}function l(t){if(1!=arguments.length)throw u("ceil",arguments.length,1);if(r(t))return Math.ceil(t);if(t instanceof e)return new e(Math.ceil(t.re),Math.ceil(t.im));if(t instanceof Array)return At.map(t,l);if(t.valueOf()!==t)return l(t.valueOf());throw f("ceil",t)}function p(t){if(1!=arguments.length)throw u("cube",arguments.length,1);if(r(t))return t*t*t;if(t instanceof e)return M(M(t,t),t);if(t instanceof Array)return M(M(t,t),t);if(t.valueOf()!==t)return p(t.valueOf());throw f("cube",t)}function m(t,n){if(2!=arguments.length)throw u("divide",arguments.length,2);if(r(t)){if(r(n))return t/n;if(n instanceof e)return v(new e(t,0),n)}if(t instanceof e){if(r(n))return v(t,new e(n,0));if(n instanceof e)return v(t,n)}if(t instanceof o&&r(n)){var i=t.clone();return i.value/=n,i}if(t instanceof Array&&!(n instanceof Array))return At.map2(t,n,m);if(t.valueOf()!==t||n.valueOf()!==n)return m(t.valueOf(),n.valueOf());throw f("divide",t,n)}function v(t,r){var n=r.re*r.re+r.im*r.im;return new e((t.re*r.re+t.im*r.im)/n,(t.im*r.re-t.re*r.im)/n)}function d(t,n){if(2!=arguments.length)throw u("equal",arguments.length,2);if(r(t)){if(r(n))return t==n;if(n instanceof e)return t==n.re&&0==n.im}if(t instanceof e){if(r(n))return t.re==n&&0==t.im;if(n instanceof e)return t.re==n.re&&t.im==n.im}if(t instanceof o&&n instanceof o){if(!t.equalBase(n))throw Error("Cannot compare units with different base");return t.value==n.value}if(a(t)||a(n))return t==n;if(t instanceof Array||n instanceof Array)return At.map2(t,n,d);if(t.valueOf()!==t||n.valueOf()!==n)return d(t.valueOf(),n.valueOf());throw f("equal",t,n)}function g(t){if(1!=arguments.length)throw u("exp",arguments.length,1);if(r(t))return Math.exp(t);if(t instanceof e){var n=Math.exp(t.re);return new e(n*Math.cos(t.im),n*Math.sin(t.im))}if(t instanceof Array)return At.map(t,g);if(t.valueOf()!==t)return g(t.valueOf());throw f("exp",t)}function y(t){if(1!=arguments.length)throw u("fix",arguments.length,1);if(r(t))return value>0?Math.floor(t):Math.ceil(t);if(t instanceof e)return new e(t.re>0?Math.floor(t.re):Math.ceil(t.re),t.im>0?Math.floor(t.im):Math.ceil(t.im));if(t instanceof Array)return At.map(t,y);if(t.valueOf()!==t)return y(t.valueOf());throw f("fix",t)}function x(t){if(1!=arguments.length)throw u("floor",arguments.length,1);if(r(t))return Math.floor(t);if(t instanceof e)return new e(Math.floor(t.re),Math.floor(t.im));if(t instanceof Array)return At.map(t,x);if(t.valueOf()!==t)return x(t.valueOf());throw f("floor",t)}function w(t,n){if(2!=arguments.length)throw u("larger",arguments.length,2);if(r(t)){if(r(n))return t>n;if(n instanceof e)return t>c(n)}if(t instanceof e){if(r(n))return c(t)>n;if(n instanceof e)return c(t)>c(n)}if(t instanceof o&&n instanceof o){if(!t.equalBase(n))throw Error("Cannot compare units with different base");return t.value>n.value}if(a(t)||a(n))return t>n;if(t instanceof Array||n instanceof Array)return At.map2(t,n,d);if(t.valueOf()!==t||n.valueOf()!==n)return w(t.valueOf(),n.valueOf());throw f("larger",t,n)}function E(t,n){if(2!=arguments.length)throw u("largereq",arguments.length,2);if(r(t)){if(r(n))return t>=n;if(n instanceof e)return t>=c(n)}if(t instanceof e){if(r(n))return c(t)>=n;if(n instanceof e)return c(t)>=c(n)}if(t instanceof o&&n instanceof o){if(!t.equalBase(n))throw Error("Cannot compare units with different base");return t.value>=n.value}if(a(t)||a(n))return t>=n;if(t instanceof Array||n instanceof Array)return At.map2(t,n,E);if(t.valueOf()!==t||n.valueOf()!==n)return E(t.valueOf(),n.valueOf());throw f("largereq",t,n)}function N(t,n){if(1!=arguments.length&&2!=arguments.length)throw u("log",arguments.length,1,2);if(void 0!==n)return m(N(t),N(n));if(r(t))return t>=0?Math.log(t):N(new e(t,0));if(t instanceof e)return new e(Math.log(Math.sqrt(t.re*t.re+t.im*t.im)),Math.atan2(t.im,t.re));if(t instanceof Array)return At.map(t,N);if(t.valueOf()!==t||n.valueOf()!==n)return N(t.valueOf(),n.valueOf());throw f("log",t,n)}function O(t){if(1!=arguments.length)throw u("log10",arguments.length,1);if(r(t))return t>=0?Math.log(t)/Math.LN10:O(new e(t,0));if(t instanceof e)return new e(Math.log(Math.sqrt(t.re*t.re+t.im*t.im))/Math.LN10,Math.atan2(t.im,t.re)/Math.LN10);if(t instanceof Array)return At.map(t,O);if(t.valueOf()!==t)return O(t.valueOf());throw f("log10",t)}function b(t,n){if(2!=arguments.length)throw u("mod",arguments.length,2);if(r(t)){if(r(n))return t%n;if(n instanceof e&&0==n.im)return t%n.re}else if(t instanceof e&&0==t.im){if(r(n))return t.re%n;if(n instanceof e&&0==n.im)return t.re%n.re}if(t instanceof Array||n instanceof Array)return At.map2(t,n,b);if(t.valueOf()!==t||n.valueOf()!==n)return b(t.valueOf(),n.valueOf());throw f("mod",t,n)}function M(t,n){if(2!=arguments.length)throw u("multiply",arguments.length,2);if(r(t)){if(r(n))return t*n;if(n instanceof e)return T(new e(t,0),n);if(n instanceof o)return s=n.clone(),s.value*=t,s}else if(t instanceof e){if(r(n))return T(t,new e(n,0));if(n instanceof e)return T(t,n)}else if(t instanceof o){if(r(n))return s=t.clone(),s.value*=n,s}else if(t instanceof Array){if(n instanceof Array){var i=At.size(t),a=At.size(n);if(2!=i.length)throw Error("Can only multiply a 2 dimensional matrix (A has "+i.length+" dimensions)");if(2!=a.length)throw Error("Can only multiply a 2 dimensional matrix (B has "+a.length+" dimensions)");if(i[1]!=a[0])throw new RangeError("Dimensions mismatch in multiplication. Columns of A must match rows of B (A is "+i[0]+"x"+i[1]+", B is "+a[0]+"x"+a[1]+", "+a[1]+" != "+a[0]+")");for(var s=[],c=i[0],l=a[1],p=i[1],m=0;c>m;m++){s[m]=[];for(var v=0;l>v;v++){for(var d=null,g=0;p>g;g++){var y=M(t[m][g],n[g][v]);d=null==d?y:h(d,y)}s[m][v]=d}}return s}return At.map2(t,n,M)}if(n instanceof Array)return At.map2(t,n,M);if(t.valueOf()!==t||n.valueOf()!==n)return M(t.valueOf(),n.valueOf());throw f("multiply",t,n)}function T(t,r){return new e(t.re*r.re-t.im*r.im,t.re*r.im+t.im*r.re)}function A(t,i){if(2!=arguments.length)throw u("pow",arguments.length,2);if(r(t)){if(r(i))return n(i)||t>=0?Math.pow(t,i):S(new e(t,0),new e(i,0));if(i instanceof e)return S(new e(t,0),i)}else if(t instanceof e){if(r(i))return S(t,new e(i,0));if(i instanceof e)return S(t,i)}else if(t instanceof Array){if(!r(i)||!n(i)||0>i)throw new TypeError("For A^b, b must be a positive integer (value is "+i+")");var a=At.size(t);if(2!=a.length)throw Error("For A^b, A must be 2 dimensional (A has "+a.length+" dimensions)");if(a[0]!=a[1])throw Error("For A^b, A must be square (size is "+a[0]+"x"+a[1]+")");if(0==i)return F(a[0]);for(var o=t,s=1;i>s;s++)o=M(t,o);return o}if(t.valueOf()!==t||i.valueOf()!==i)return A(t.valueOf(),i.valueOf());throw f("pow",t,i)}function S(e,t){var r=N(e),n=M(r,t);return g(n)}function _(t,n){if(1!=arguments.length&&2!=arguments.length)throw u("round",arguments.length,1,2);if(void 0==n){if(r(t))return Math.round(t);if(t instanceof e)return new e(Math.round(t.re),Math.round(t.im));if(t instanceof Array&&At.map(t,_),t.valueOf()!==t)return _(t.valueOf());throw f("round",t)}if(!r(n))throw new TypeError("Number of digits in function round must be an integer");if(n!==Math.round(n))throw new TypeError("Number of digits in function round must be integer");if(0>n||n>9)throw Error("Number of digits in function round must be in te range of 0-9");if(r(t))return k(t,n);if(t instanceof e)return new e(k(t.re,n),k(t.im,n));if(t instanceof Array||n instanceof Array)return At.map2(t,n,_);if(t.valueOf()!==t||n.valueOf()!==n)return w(t.valueOf(),n.valueOf());throw f("round",t,n)}function k(e,t){var r=Math.pow(10,void 0!=t?t:Tt.options.precision);return Math.round(e*r)/r}function U(t){if(1!=arguments.length)throw u("sign",arguments.length,1);if(r(t)){var n;return n=t>0?1:0>t?-1:0}if(t instanceof e){var i=Math.sqrt(t.re*t.re+t.im*t.im);return new e(t.re/i,t.im/i)}if(t instanceof Array)return At.map(t,n);if(t.valueOf()!==t)return n(t.valueOf());throw f("sign",t)}function q(t,n){if(2!=arguments.length)throw u("smaller",arguments.length,2);if(r(t)){if(r(n))return n>t;if(n instanceof e)return c(n)>t}if(t instanceof e){if(r(n))return n>c(t);if(n instanceof e)return c(t)<c(n)}if(t instanceof o&&n instanceof o){if(!t.equalBase(n))throw Error("Cannot compare units with different base");return t.value<n.value}if(a(t)||a(n))return n>t;if(t instanceof Array||n instanceof Array)return At.map2(t,n,q);if(t.valueOf()!==t||n.valueOf()!==n)return q(t.valueOf(),n.valueOf());throw f("smaller",t,n)}function z(t,n){if(2!=arguments.length)throw u("smallereq",arguments.length,2);if(r(t)){if(r(n))return n>=t;if(n instanceof e)return c(n)>=t}if(t instanceof e){if(r(n))return n>=c(t);if(n instanceof e)return c(t)<=c(n)}if(t instanceof o&&n instanceof o){if(!t.equalBase(n))throw Error("Cannot compare units with different base");return t.value<=n.value}if(a(t)||a(n))return n>=t;if(t instanceof Array||n instanceof Array)return At.map2(t,n,z);if(t.valueOf()!==t||n.valueOf()!==n)return z(t.valueOf(),n.valueOf());throw f("smallereq",t,n)}function L(t){if(1!=arguments.length)throw u("sqrt",arguments.length,1);if(r(t))return t>=0?Math.sqrt(t):L(new e(t,0));if(t instanceof e){var n=Math.sqrt(t.re*t.re+t.im*t.im);return t.im>=0?new e(.5*Math.sqrt(2*(n+t.re)),.5*Math.sqrt(2*(n-t.re))):new e(.5*Math.sqrt(2*(n+t.re)),-.5*Math.sqrt(2*(n-t.re)))}if(t instanceof Array)return At.map(t,L);if(t.valueOf()!==t)return L(t.valueOf());throw f("sqrt",t)}function R(t){if(1!=arguments.length)throw u("square",arguments.length,1);if(r(t))return t*t;if(t instanceof e)return M(t,t);if(t instanceof Array)return M(t,t);if(t.valueOf()!==t)return R(t.valueOf());throw f("square",t)}function C(t,n){if(2!=arguments.length)throw u("subtract",arguments.length,2);if(r(t)){if(r(n))return t-n;if(n instanceof e)return new e(t-n.re,n.im)}else if(t instanceof e){if(r(n))return new e(t.re-n,t.im);if(n instanceof e)return new e(t.re-n.re,t.im-n.im)}else if(t instanceof o&&n instanceof o){if(!t.equalBase(n))throw Error("Units do not match");if(!t.hasValue)throw Error("Unit on left hand side of operator - has no value");if(!n.hasValue)throw Error("Unit on right hand side of operator - has no value");var i=t.clone();return i.value-=n.value,i.fixPrefix=!1,i}if(t instanceof Array||n instanceof Array)return At.map2(t,n,C);if(t.valueOf()!==t||n.valueOf()!==n)return C(t.valueOf(),n.valueOf());throw f("subtract",t,n)}function I(t){if(1!=arguments.length)throw u("unaryminus",arguments.length,1);if(r(t))return-t;if(t instanceof e)return new e(-t.re,-t.im);if(t instanceof o){var n=t.clone();return n.value=-t.value,n}if(t instanceof Array)return At.map(t,I);if(t.valueOf()!==t)return I(t.valueOf());throw f("unaryminus",t)}function P(t,n){if(2!=arguments.length)throw u("unequal",arguments.length,2);if(r(t)){if(r(n))return t==n;if(n instanceof e)return t==n.re&&0==n.im}if(t instanceof e){if(r(n))return t.re==n&&0==t.im;if(n instanceof e)return t.re==n.re&&t.im==n.im}if(t instanceof o&&n instanceof o){if(!t.equalBase(n))throw Error("Cannot compare units with different base");return t.value==n.value}if(a(t)||a(n))return t==n;if(t instanceof Array||n instanceof Array)return At.map2(t,n,P);if(t.valueOf()!==t||n.valueOf()!==n)return P(t.valueOf(),n.valueOf());throw f("unequal",t,n)}function V(t){if(1!=arguments.length)throw u("arg",arguments.length,1);if(r(t))return Math.atan2(0,t);if(t instanceof e)return Math.atan2(t.im,t.re);if(t instanceof Array)return At.map(t,V);if(t.valueOf()!==t)return V(t.valueOf());throw f("arg",t)}function B(t){if(1!=arguments.length)throw u("conj",arguments.length,1);if(r(t))return t;if(t instanceof e)return new e(t.re,-t.im);if(t instanceof Array)return At.map(t,B);if(t.valueOf()!==t)return B(t.valueOf());throw f("conj",t)}function D(t){if(1!=arguments.length)throw u("im",arguments.length,1);if(r(t))return 0;if(t instanceof e)return t.im;if(t instanceof Array)return At.map(t,D);if(t.valueOf()!==t)return D(t.valueOf());throw f("im",t)}function G(t){if(1!=arguments.length)throw u("re",arguments.length,1);if(r(t))return t;if(t instanceof e)return t.re;if(t instanceof Array)return At.map(t,G);if(t.valueOf()!==t)return G(t.valueOf());throw f("re",t)}function Y(e,a){var o,f,c,h;if(1!=arguments.length&&2!=arguments.length)throw u("diag",arguments.length,1,2);if(a){if(!r(a)||!n(a))throw new TypeError("Second parameter in function diag must be an integer")}else a=0;var l=a>0?a:0,p=0>a?-a:0;if(e instanceof t?e.isVector()&&(e=e.toVector()):e instanceof s||(e instanceof i?e=e.toVector():e instanceof Array?(e=new t(e),e.isVector()&&(e=e.toVector())):(e=new t(e),e.isVector()&&(e=e.toVector()))),e instanceof s){f=e.valueOf();var m=new t;for(m.resize([f.length+p,f.length+l]),o=m.valueOf(),h=f.length,c=0;h>c;c++)o[c+p][c+l]=ut(f[c]);return m}var v=e.size();if(2!=v.length)throw new RangeError("Matrix for function diag must be 2 dimensional");for(f=[],o=e.valueOf(),h=Math.min(v[0]-p,v[1]-l),c=0;h>c;c++)f[c]=ut(o[c+p][c+l]);return new s(f)}function F(){var e=At.argsToArray(arguments);if(0==e.length)e=[1,1];else if(1==e.length)e[1]=e[0];else if(e.length>2)throw u("eye",num,0,2);var i=e[0],a=e[1];if(!r(i)||!n(i)||1>i)throw Error("Parameters in function eye must be positive integers");if(a&&(!r(a)||!n(a)||1>a))throw Error("Parameters in function eye must be positive integers");var o=new t;o.resize(e);for(var s=Tt.min(e),f=o.valueOf(),c=0;s>c;c++)f[c][c]=1;return o}function j(){var e=At.argsToArray(arguments);0==e.length?e=[1,1]:1==e.length&&(e[1]=e[0]);var r=new t,n=1;return r.resize(e,n),r}function H(n){if(1!=arguments.length)throw u("size",arguments.length,1);if(r(n)||n instanceof e||n instanceof o||null==n)return[];if(a(n))return[n.length];if(n instanceof Array)return At.size(n);if(n instanceof t||n instanceof s||n instanceof i)return n.size();if(n.valueOf()!==n)return H(n.valueOf());throw f("size",n)}function K(){var e=At.argsToArray(arguments);0==e.length?e=[1,1]:1==e.length&&(e[1]=e[0]);var r=new t;return r.resize(e),r}function W(e){if(1!=arguments.length)throw u("factorial",arguments.length,1);if(r(e)){if(!n(e))throw new TypeError("Function factorial can only handle integer values");var t=e,i=t;for(t--;t>1;)i*=t,t--;return 0==i&&(i=1),i}if(e instanceof Array)return At.map(e,W);if(e.valueOf()!==e)return W(e.valueOf());throw f("factorial",e)}function X(){if(0!=arguments.length)throw u("random",arguments.length,0);return Math.random()}function Z(e){if(0==arguments.length)throw Error("Function sum requires one or more parameters (0 provided)");if(1==arguments.length&&e.valueOf()instanceof Array)return Z.apply(this,e.valueOf());for(var t=arguments[0],r=1,n=arguments.length;n>r;r++){var i=arguments[r];w(i,t)&&(t=i)}return t}function Q(e){if(0==arguments.length)throw Error("Function sum requires one or more parameters (0 provided)");if(1==arguments.length&&e.valueOf()instanceof Array)return Q.apply(this,e.valueOf());for(var t=arguments[0],r=1,n=arguments.length;n>r;r++){var i=arguments[r];q(i,t)&&(t=i)}return t}function J(t){if(1!=arguments.length)throw u("acos",arguments.length,1);if(r(t))return t>=-1&&1>=t?Math.acos(t):J(new e(t,0));if(t instanceof e){var n=new e(t.im*t.im-t.re*t.re+1,-2*t.re*t.im),i=L(n),a=new e(i.re-t.im,i.im+t.re),o=N(a);return new e(1.5707963267948966-o.im,o.re)}if(t instanceof Array)return At.map(t,J);if(t.valueOf()!==t)return J(t.valueOf());throw f("acos",t)}function $(t){if(1!=arguments.length)throw u("asin",arguments.length,1);if(r(t))return t>=-1&&1>=t?Math.asin(t):$(new e(t,0));if(t instanceof e){var n=t.re,i=t.im,a=new e(i*i-n*n+1,-2*n*i),o=L(a),s=new e(o.re-i,o.im+n),c=N(s);return new e(c.im,-c.re)}if(t instanceof Array)return At.map(t,$);if(t.valueOf()!==t)return $(t.valueOf());throw f("asin",t)}function et(t){if(1!=arguments.length)throw u("atan",arguments.length,1);if(r(t))return Math.atan(t);if(t instanceof e){var n=t.re,i=t.im,a=n*n+(1-i)*(1-i),o=new e((1-i*i-n*n)/a,-2*n/a),s=N(o);return new e(-.5*s.im,.5*s.re)}if(t instanceof Array)return At.map(t,et);if(t.valueOf()!==t)return et(t.valueOf());throw f("atan",t)}function tt(t,n){if(2!=arguments.length)throw u("atan2",arguments.length,2);if(r(t)){if(r(n))return Math.atan2(t,n);if(n instanceof e)return Math.atan2(t,n.re)}else if(t instanceof e){if(r(n))return Math.atan2(t.re,n);if(n instanceof e)return Math.atan2(t.re,n.re)}if(n instanceof Array||t instanceof Array)return At.map2(t,n,tt);if(n.valueOf()!==n||t.valueOf()!==t)return tt(t.valueOf(),n.valueOf());throw f("atan2",t,n)}function rt(t){if(1!=arguments.length)throw u("cos",arguments.length,1);if(r(t))return Math.cos(t);if(t instanceof e)return new e(.5*Math.cos(t.re)*(Math.exp(-t.im)+Math.exp(t.im)),.5*Math.sin(t.re)*(Math.exp(-t.im)-Math.exp(t.im)));if(t instanceof o){if(!t.hasBase(o.BASE_UNITS.ANGLE))throw new TypeError("Unit in function cos is no angle");return Math.cos(t.value)}if(t instanceof Array)return At.map(t,rt);if(t.valueOf()!==t)return rt(t.valueOf());throw f("cos",t)}function nt(t){if(1!=arguments.length)throw u("cot",arguments.length,1);if(r(t))return 1/Math.tan(t);if(t instanceof e){var n=Math.exp(-4*t.im)-2*Math.exp(-2*t.im)*Math.cos(2*t.re)+1;return new e(2*Math.exp(-2*t.im)*Math.sin(2*t.re)/n,(Math.exp(-4*t.im)-1)/n)}if(t instanceof o){if(!t.hasBase(o.BASE_UNITS.ANGLE))throw new TypeError("Unit in function cot is no angle");return 1/Math.tan(t.value)}if(t instanceof Array)return At.map(t,nt);if(t.valueOf()!==t)return nt(t.valueOf());throw f("cot",t)}function it(t){if(1!=arguments.length)throw u("csc",arguments.length,1);if(r(t))return 1/Math.sin(t);if(t instanceof e){var n=.25*(Math.exp(-2*t.im)+Math.exp(2*t.im))-.5*Math.cos(2*t.re);return new e(.5*Math.sin(t.re)*(Math.exp(-t.im)+Math.exp(t.im))/n,.5*Math.cos(t.re)*(Math.exp(-t.im)-Math.exp(t.im))/n)}if(t instanceof o){if(!t.hasBase(o.BASE_UNITS.ANGLE))throw new TypeError("Unit in function csc is no angle");return 1/Math.sin(t.value)}if(t instanceof Array)return At.map(t,it);if(t.valueOf()!==t)return it(t.valueOf());throw f("csc",t)}function at(t){if(1!=arguments.length)throw u("sec",arguments.length,1);if(r(t))return 1/Math.cos(t);if(t instanceof e){var n=.25*(Math.exp(-2*t.im)+Math.exp(2*t.im))+.5*Math.cos(2*t.re);return new e(.5*Math.cos(t.re)*(Math.exp(-t.im)+Math.exp(t.im))/n,.5*Math.sin(t.re)*(Math.exp(t.im)-Math.exp(-t.im))/n)}if(t instanceof o){if(!t.hasBase(o.BASE_UNITS.ANGLE))throw new TypeError("Unit in function sec is no angle");return 1/Math.cos(t.value)}if(t instanceof Array)return At.map(t,at);if(t.valueOf()!==t)return at(t.valueOf());throw f("sec",t)}function ot(t){if(1!=arguments.length)throw u("sin",arguments.length,1);if(r(t))return Math.sin(t);if(t instanceof e)return new e(.5*Math.sin(t.re)*(Math.exp(-t.im)+Math.exp(t.im)),.5*Math.cos(t.re)*(Math.exp(t.im)-Math.exp(-t.im)));if(t instanceof o){if(!t.hasBase(o.BASE_UNITS.ANGLE))throw new TypeError("Unit in function cos is no angle");return Math.sin(t.value)}if(t instanceof Array)return At.map(t,ot);if(t.valueOf()!==t)return ot(t.valueOf());throw f("sin",t)}function st(t){if(1!=arguments.length)throw u("tan",arguments.length,1);if(r(t))return Math.tan(t);if(t instanceof e){var n=Math.exp(-4*t.im)+2*Math.exp(-2*t.im)*Math.cos(2*t.re)+1;return new e(2*Math.exp(-2*t.im)*Math.sin(2*t.re)/n,(1-Math.exp(-4*t.im))/n)}if(t instanceof o){if(!t.hasBase(o.BASE_UNITS.ANGLE))throw new TypeError("Unit in function tan is no angle");return Math.tan(t.value)}if(t instanceof Array)return At.map(t,st);if(t.valueOf()!==t)return st(t.valueOf());throw f("tan",t)}function ft(e,t){if(2!=arguments.length)throw u("in",arguments.length,2);if(e instanceof o&&t instanceof o){if(!e.equalBase(t))throw Error("Units do not match");if(t.hasValue)throw Error("Cannot convert to a unit with a value");if(!t.hasUnit)throw Error("Unit expected on the right hand side of function in");var r=t.clone();return r.value=e.value,r.fixPrefix=!0,r}if(e instanceof Array||t instanceof Array)return At.map2(e,t,ft);if(e.valueOf()!==e)return Tt.in(e.valueOf());throw f("in",e)}function ut(e){if(1!=arguments.length)throw u("clone",arguments.length,1);if(null==e)return e;if("function"==typeof e.clone)return e.clone();if(r(e)||a(e))return e;if(e instanceof Array)return e.map(function(e){return ut(e)});if(e instanceof Object)return At.map(e,ut);throw f("clone",e)}function ct(e,t){var n=arguments.length;if(1!=n&&2!=n)throw u("format",n,1,2);if(1==n){var i=arguments[0];return r(i)?At.formatNumber(i):i instanceof Array?At.formatArray(i):a(i)?'"'+i+'"':i instanceof Object?""+i:i+""}if(!a(e))throw new TypeError("String expected as first parameter in function format");if(!(t instanceof Object))throw new TypeError("Object expected as first parameter in function format");return e.replace(/\$([\w\.]+)/g,function(e,r){for(var n=r.split("."),i=t[n.shift()];n.length&&void 0!=i;){var a=n.shift();i=a?i[a]:i+"."}return void 0!=i?i:e})}function ht(e){if(1!=arguments.length)throw u("help",arguments.length,1);if(void 0!=e){if(e.doc)return lt(e.doc);if(e.constructor.doc)return lt(e.constructor.doc);if(a(e)){var t=Tt[e];if(t&&t.doc)return lt(t.doc)}}return e instanceof Object&&e.name?'No documentation found on subject "'+e.name+'"':e instanceof Object&&e.constructor.name?'No documentation found on subject "'+e.constructor.name+'"':'No documentation found on subject "'+e+'"'}function lt(e){var t="";if(e.name&&(t+="NAME\n"+e.name+"\n\n"),e.category&&(t+="CATEGORY\n"+e.category+"\n\n"),e.syntax&&(t+="SYNTAX\n"+e.syntax.join("\n")+"\n\n"),e.examples){var r=new Tt.parser.Parser;t+="EXAMPLES\n";for(var n=0;e.examples.length>n;n++){var i,a=e.examples[n];try{i=r.eval(a)}catch(o){i=o}t+=a+"\n",t+="    "+Tt.format(i)+"\n"}t+="\n"}return e.seealso&&(t+="SEE ALSO\n"+e.seealso.join(", ")+"\n"),t}function pt(e,t){var r;if(a(e)){if("undefined"==typeof require)throw Error("Cannot load file: require not available.");var n=require(e);pt(n)}else if(mt(e)){if(r=e.name,!r)throw Error("Cannot import an unnamed function");(t||void 0===Tt[r])&&(Tt[r]=e)}else if(e instanceof Object)for(r in e)if(e.hasOwnProperty(r)){var i=e[r];mt(i)?(t||void 0===Tt[r])&&(Tt[r]=i):pt(i)}}function mt(t){return"function"==typeof t||r(t)||a(t)||t instanceof e||t instanceof o}function vt(e){if(1!=arguments.length)throw u("typeof",arguments.length,1);var t=typeof e;if("object"==t){if(null==e)return"null";if(e.constructor){for(var r in Tt)if(Tt.hasOwnProperty(r)&&e.constructor==Tt[r])return r.toLowerCase();if(e.constructor.name)return e.constructor.name.toLowerCase()}}return t}function dt(){}function gt(e,t,r){this.name=e,this.fn=t,this.params=r}function yt(e){this.value=e}function xt(e){this.nodes=e||[]}function wt(){this.params=[],this.visible=[]}function Et(e,t,r,n){this.name=e,this.params=t,this.expr=r,this.result=n}function Nt(e,t,r,n,i){this.name=e,this.variables=r,this.values=[];for(var a=0,o=this.variables.length;o>a;a++)this.values[a]=function(){var e=function(){return e.value};return e.value=void 0,e}();this.def=this.createFunction(e,t,r,n),this.result=i}function Ot(e){this.parentScope=e,this.nestedScopes=void 0,this.symbols={},this.defs={},this.updates={},this.links={}}function bt(){if(this.constructor!=bt)throw new SyntaxError("Parser constructor must be called with the new operator");this.TOKENTYPE={NULL:0,DELIMITER:1,NUMBER:2,SYMBOL:3,UNKNOWN:4},this.expr="",this.index=0,this.c="",this.token="",this.token_type=this.TOKENTYPE.NULL,this.scope=new Ot}function Mt(){this.idMax=-1,this.updateSeq=0,this.parser=new bt,this.scope=new Ot,this.nodes={},this.firstNode=void 0,this.lastNode=void 0}var Tt={parser:{node:{}},options:{precision:10}};"undefined"!=typeof module&&module.exports!==void 0&&(module.exports=Tt),"undefined"!=typeof exports&&(exports=Tt),"undefined"!=typeof require&&"undefined"!=typeof define&&define(function(){return Tt}),"undefined"!=typeof window&&(window.math=Tt);var At=function(){function e(e){if(e instanceof Array){var t=e.length;if(t){var r=c(e[0]);return 0==r[0]?[0].concat(r):[t].concat(r)}return[t]}return[]}function a(e,t,r){var n,i=e.length;if(i!=t[r])throw new RangeError("Dimension mismatch ("+i+" != "+t[r]+")");if(t.length-1>r){var o=r+1;for(n=0;i>n;n++){var s=e[n];if(!(s instanceof Array))throw new RangeError("Dimension mismatch ("+(t.length-1)+" < "+t.length+")");a(e[n],t,o)}}else for(n=0;i>n;n++)if(e[n]instanceof Array)throw new RangeError("Dimension mismatch ("+(t.length+1)+" > "+t.length+")")}function o(e,t,r){if(t.length-1>r){var n=e[0];if(1!=e.length||!(n instanceof Array))throw new RangeError("Dimension mismatch ("+e.length+" > 0)");o(n,t,r+1)}else if(e.length)throw new RangeError("Dimension mismatch ("+e.length+" > 0)")}function f(e,t,r,n){if(!(e instanceof Array))throw new TypeError("Array expected");var i=e.length,a=t[r];if(i!=a){if(a>e.length)for(var o=e.length;a>o;o++)e[o]=n?ut(n):0;else e.length=t[r];i=e.length}if(t.length-1>r){var s=r+1;for(o=0;i>o;o++)u=e[o],u instanceof Array||(u=[u],e[o]=u),f(u,t,s,n)}else for(o=0;i>o;o++){for(var u=e[o];u instanceof Array;)u=u[0];e[o]=u}}var u={};return u.formatNumber=function(e,t){if(1/0===e)return"Infinity";if(e===-1/0)return"-Infinity";if(0/0===e)return"NaN";var r=Math.abs(e);if(r>1e-4&&1e6>r||0==r)return k(e,t)+"";var n=Math.round(Math.log(r)/Math.LN10),i=e/Math.pow(10,n);return k(i,t)+"E"+n},u.formatArray=function(e){if(e instanceof Array){for(var t="[",r=e.length,n=0;r>n;n++)0!=n&&(t+=", "),t+=u.formatArray(e[n]);return t+="]"}return ct(e)},u.formatArray2d=function(e){var t="[",r=u.size(e);if(2!=r.length)throw new RangeError("Array must be two dimensional (size: "+u.formatArray(r)+")");for(var n=r[0],i=r[1],a=0;n>a;a++){0!=a&&(t+="; ");for(var o=e[a],s=0;i>s;s++){0!=s&&(t+=", ");var f=o[s];void 0!=f&&(t+=ct(f))}}return t+="]"},u.argsToArray=function(e){var r;if(0==e.length)r=[];else if(1==e.length)r=e[0],r instanceof t&&(r=r.toVector()),(r instanceof s||r instanceof i)&&(r=r.valueOf()),r instanceof Array||(r=[r]);else{r=[];for(var n=0;e.length>n;n++)r[n]=e[n]}return r},u.randomUUID=function(){var e=function(){return Math.floor(65536*Math.random()).toString(16)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},u.map=function(e,t){if(!e instanceof Array)throw new TypeError("Array expected");return e.map(function(e){return t(e)})},u.map2=function(e,t,r){var n,i,a;if(e instanceof Array)if(t instanceof Array){if(e.length!=t.length)throw new RangeError("Dimension mismatch ("+e.length+" != "+t.length+")");for(n=[],i=e.length,a=0;i>a;a++)n[a]=r(e[a],t[a])}else for(n=[],i=e.length,a=0;i>a;a++)n[a]=r(e[a],t);else if(t instanceof Array)for(n=[],i=t.length,a=0;i>a;a++)n[a]=r(e,t[a]);else n=r(e,t);return n},u.forEach=function(e,t){if(e instanceof Array)e.forEach(t);else for(var r in e)e.hasOwnProperty(r)&&t(e[r],r,e)},u.map=function(e,t){if(e instanceof Array)return e.map(t);var r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]=t(e[n]));return r},u.size=function c(t){var r=e(t);return u.validate(t,r),r},u.validate=function(e,t){var r=0==t.length;if(r){if(e instanceof Array)throw new RangeError("Dimension mismatch ("+e.length+" != 0)")}else{var n=-1!=t.indexOf(0);n?(t.forEach(function(e){if(0!=e)throw new RangeError("Invalid size, all dimensions must be either zero or non-zero (size: "+u.formatArray(t)+")")}),o(e,t,0)):a(e,t,0)}},u.resize=function(e,t,i){if(!(t instanceof Array))throw new TypeError("Size must be an array (size is "+type(t)+")");t.forEach(function(e){if(!r(e)||!n(e)||0>e)throw new TypeError("Invalid size, must contain positive integers (size: "+u.formatArray(t)+")")});var a=-1!=t.indexOf(0);a&&t.forEach(function(e){if(0!=e)throw new RangeError("Invalid size, all dimensions must be either zero or non-zero (size: "+u.formatArray(t)+")")}),f(e,t,0,i)},Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;this.length>t;t++)if(this[t]==e)return t;
return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var r=0,n=this.length;n>r;++r)e.call(t||this,this[r],r,this)}),Array.prototype.map||(Array.prototype.map=function(e,t){var r,n,i;if(null==this)throw new TypeError(" this is null or not defined");var a=Object(this),o=a.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(t&&(r=t),n=Array(o),i=0;o>i;){var s,f;i in a&&(s=a[i],f=e.call(r,s,i,a),n[i]=f),i++}return n}),Array.prototype.every||(Array.prototype.every=function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),r=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var n=arguments[1],i=0;r>i;i++)if(i in t&&!e.call(n,t[i],i,t))return!1;return!0}),u}();Tt.Complex=e,function(){function t(){for(;" "==h||"	"==h;)i()}function r(e){return e>="0"&&"9">=e||"."==e}function n(e){return e>="0"&&"9">=e}function i(){c++,h=u[c]}function o(e){c=e,h=u[c]}function s(){var e="",t=c;if("+"==h?i():"-"==h&&(e+=h,i()),!r(h))return o(t),null;for(;r(h);)e+=h,i();if("E"==h||"e"==h){if(e+=h,i(),("+"==h||"-"==h)&&(e+=h,i()),!n(h))return o(t),null;for(;n(h);)e+=h,i()}return e}function f(){var e=u[c+1];if("I"==h||"i"==h)return i(),"1";if(!("+"!=h&&"-"!=h||"I"!=e&&"i"!=e)){var t="+"==h?"1":"-1";return i(),i(),t}return null}var u,c,h;e.parse=function(r){if(u=r,c=-1,h="",!a(u))return null;i(),t();var n=s();if(n){if("I"==h||"i"==h)return i(),t(),h?null:new e(0,Number(n));t();var o=h;if("+"!=o&&"-"!=o)return t(),h?null:new e(Number(n),0);i(),t();var l=s();if(l){if("I"!=h&&"i"!=h)return null;i()}else if(l=f(),!l)return null;return"-"==o&&(l="-"==l[0]?"+"+l.substring(1):"-"+l),i(),t(),h?null:new e(Number(n),Number(l))}return(n=f())?(t(),h?null:new e(0,Number(n))):null}}(),e.prototype.clone=function(){return new e(this.re,this.im)},e.prototype.toString=function(){var e="",t=At.formatNumber(this.re),r=At.formatNumber(this.im);return e=0==this.im?t:0==this.re?1==this.im?"i":-1==this.im?"-i":r+"i":this.im>0?1==this.im?t+" + i":t+" + "+r+"i":-1==this.im?t+" - i":t+" - "+At.formatNumber(Math.abs(this.im))+"i"},e.doc={name:"Complex",category:"type",syntax:["a + bi","a + b * i"],description:"A complex value a + bi, where a is the real part and b is the complex part, and i is the imaginary number defined as sqrt(-1).",examples:["2 + 3i","sqrt(-4)","(1.2 -5i) * 2"],seealso:["abs","arg","conj","im","re"]},Tt.Matrix=t,t.prototype.get=function(e){if(e instanceof t){if(!e.isVector())throw new RangeError("Index must be a vector (size: "+ct(e.size())+")");e=e.toVector()}if(e instanceof s&&(e=e.valueOf()),e instanceof Array){if(e.length!=this._size.length)throw new RangeError("Number of dimensions do not match ("+e.length+" != "+this._size.length+")");var i=this._data;return e.forEach(function(e){if(!r(e)||!n(e)||0>e)throw new TypeError("Positive integer expected as index in method get");if(e>i.length-1)throw new RangeError("Index out of range ("+e+")");i=i[e]}),i}throw new TypeError("Unsupported type of index "+type(e))},t.prototype.set=function(e,a){if(e instanceof t){if(!e.isVector())throw new RangeError("Index must be a vector (size: "+ct(e.size())+")");e=e.toVector()}if(e instanceof s&&(e=e.valueOf()),(a instanceof t||a instanceof s||a instanceof i)&&(a=a.valueOf()),!(e instanceof Array))throw new TypeError("Unsupported type of index "+type(e));if(a instanceof Array)throw Error("Setting a range of values is not yet implemented...");var o=this._size.concat([]),f=!1;e.length!=this._size.length&&(f=!0);for(var u=0;e.length>u;u++){var c=e[u];if(!r(c)||!n(c)||0>c)throw new TypeError("Positive integer expected as index in method get");(void 0==o[u]||c+1>o[u])&&(o[u]=c+1,f=!0)}f&&this.resize(o);var h=o.length,l=this._data;e.forEach(function(e,t){h-1>t?l=l[e]:l[e]=a})},t.prototype.resize=function(e,t){At.resize(this._data,e,t),this._size=ut(e)},t.prototype.clone=function(){var e=new t;return e._data=ut(this._data),e},t.prototype.size=function(){return this._size},t.prototype.toScalar=function(){for(var e=this._data;e instanceof Array&&1==e.length;)e=e[0];return e instanceof Array?null:ut(e)},t.prototype.isScalar=function(){return this._size.every(function(e){return 1>=e})},t.prototype.toVector=function(){var e=0,t=void 0,r=[];if(this._size.forEach(function(n,i){n>1&&(e++,t=i),r[i]=0}),0==e)return new s(this.toScalar());if(1==e){for(var n=[],i=0,a=this._size[t];a>i;i++)r[t]=i,n[i]=ut(this.get(r));return new s(n)}return null},t.prototype.isVector=function(){var e=0;return this._size.forEach(function(t){t>1&&e++}),1>=e},t.prototype.toArray=function(){return ut(this._data)},t.prototype.valueOf=function(){return this._data},t.prototype.toString=function(){return At.formatArray(this._data)},Tt.Range=i,i.prototype.clone=function(){return new i(this.start,this.step,this.end)},i.prototype.size=function(){var e=0,t=Number(this.start),r=Number(this.step),n=Number(this.end),i=n-t;return U(r)==U(i)?e=Math.floor(i/r)+1:0==i&&(e=1),isNaN(e)&&(e=0),[e]},i.prototype.forEach=function(e){var t=Number(this.start),r=Number(this.step),n=Number(this.end),i=0;if(r>0)for(;n>=t;)e(t,i),t+=r,i++;else if(0>r)for(;t>=n;)e(t,i),t+=r,i++},i.prototype.map=function(e){var t=[];return this.forEach(function(r,n){t[n]=e(r)}),t},s.prototype.toMatrix=function(){return new t(this.toArray())},i.prototype.toVector=function(){return new s(this.toArray())},i.prototype.toArray=function(){var e=[];return this.forEach(function(t,r){e[r]=t}),e},i.prototype.valueOf=function(){return this.toArray()},i.prototype.toString=function(){var e=ct(Number(this.start));return 1!=this.step&&(e+=":"+ct(Number(this.step))),e+=":"+ct(Number(this.end))},Tt.Unit=o,function(){function e(){for(;" "==h||"	"==h;)n()}function t(e){return e>="0"&&"9">=e||"."==e}function r(e){return e>="0"&&"9">=e}function n(){c++,h=u[c]}function i(e){c=e,h=u[c]}function s(){var e="",a=c;if("+"==h?n():"-"==h&&(e+=h,n()),!t(h))return i(a),null;for(;t(h);)e+=h,n();if("E"==h||"e"==h){if(e+=h,n(),("+"==h||"-"==h)&&(e+=h,n()),!r(h))return i(a),null;for(;r(h);)e+=h,n()}return e}function f(){var t="";for(e();h&&" "!=h&&"	"!=h;)t+=h,n();return t||null}var u,c,h;o.parse=function(t){if(u=t,c=-1,h="",!a(u))return null;n(),e();var r,i=s();return i?(r=f(),n(),e(),h?null:i&&r?new o(Number(i),r):null):(r=f(),n(),e(),h?null:new o(null,r))}}(),o.prototype.clone=function(){var e=new o;for(var t in this)this.hasOwnProperty(t)&&(e[t]=this[t]);return e},o.endsWith=function(e,t){var r=e.length-t.length,n=e.length;return e.substring(r,n)===t},o.prototype._normalize=function(e){return(e+this.unit.offset)*this.unit.value*this.prefix.value},o.prototype._unnormalize=function(e,t){return void 0===t?e/this.unit.value/this.prefix.value-this.unit.offset:e/this.unit.value/t-this.unit.offset},o.isUnit=function(e){for(var t=o.UNITS,r=t.length,n=0;r>n;n++){var i=t[n];if(o.endsWith(e,i.name)){var a=e.length-i.name.length;if(0==a)return!0;var s=e.substring(0,a),f=i.prefixes[s];if(void 0!==f)return!0}}return!1},o.prototype.hasBase=function(e){return void 0===this.unit.base?void 0===e:this.unit.base===e},o.prototype.equalBase=function(e){return this.unit.base===e.unit.base},o.prototype.equals=function(e){return this.equalBase(e)&&this.value==e.value},o.prototype.toString=function(){var e;if(this.fixPrefix)return e=this._unnormalize(this.value),At.formatNumber(e)+" "+this.prefix.name+this.unit.name;var t=Math.abs(this.value/this.unit.value),r=o.PREFIX_NONE,n=Math.abs(Math.log(t/r.value)/Math.LN10-1.2),i=this.unit.prefixes;for(var a in i)if(i.hasOwnProperty(a)){var s=i[a];if(s.scientific){var f=Math.abs(Math.log(t/s.value)/Math.LN10-1.2);n>f&&(r=s,n=f)}}return e=this._unnormalize(this.value,r.value),At.formatNumber(e)+" "+r.name+this.unit.name},o.PREFIXES={NONE:{"":{name:"",value:1,scientific:!0}},SHORT:{"":{name:"",value:1,scientific:!0},da:{name:"da",value:10,scientific:!1},h:{name:"h",value:100,scientific:!1},k:{name:"k",value:1e3,scientific:!0},M:{name:"M",value:1e6,scientific:!0},G:{name:"G",value:1e9,scientific:!0},T:{name:"T",value:1e12,scientific:!0},P:{name:"P",value:1e15,scientific:!0},E:{name:"E",value:1e18,scientific:!0},Z:{name:"Z",value:1e21,scientific:!0},Y:{name:"Y",value:1e24,scientific:!0},d:{name:"d",value:.1,scientific:!1},c:{name:"c",value:.01,scientific:!1},m:{name:"m",value:.001,scientific:!0},u:{name:"u",value:1e-6,scientific:!0},n:{name:"n",value:1e-9,scientific:!0},p:{name:"p",value:1e-12,scientific:!0},f:{name:"f",value:1e-15,scientific:!0},a:{name:"a",value:1e-18,scientific:!0},z:{name:"z",value:1e-21,scientific:!0},y:{name:"y",value:1e-24,scientific:!0}},LONG:{"":{name:"",value:1,scientific:!0},deca:{name:"deca",value:10,scientific:!1},hecto:{name:"hecto",value:100,scientific:!1},kilo:{name:"kilo",value:1e3,scientific:!0},mega:{name:"mega",value:1e6,scientific:!0},giga:{name:"giga",value:1e9,scientific:!0},tera:{name:"tera",value:1e12,scientific:!0},peta:{name:"peta",value:1e15,scientific:!0},exa:{name:"exa",value:1e18,scientific:!0},zetta:{name:"zetta",value:1e21,scientific:!0},yotta:{name:"yotta",value:1e24,scientific:!0},deci:{name:"deci",value:.1,scientific:!1},centi:{name:"centi",value:.01,scientific:!1},milli:{name:"milli",value:.001,scientific:!0},micro:{name:"micro",value:1e-6,scientific:!0},nano:{name:"nano",value:1e-9,scientific:!0},pico:{name:"pico",value:1e-12,scientific:!0},femto:{name:"femto",value:1e-15,scientific:!0},atto:{name:"atto",value:1e-18,scientific:!0},zepto:{name:"zepto",value:1e-21,scientific:!0},yocto:{name:"yocto",value:1e-24,scientific:!0}},BINARY_SHORT:{"":{name:"",value:1,scientific:!0},k:{name:"k",value:1024,scientific:!0},M:{name:"M",value:Math.pow(1024,2),scientific:!0},G:{name:"G",value:Math.pow(1024,3),scientific:!0},T:{name:"T",value:Math.pow(1024,4),scientific:!0},P:{name:"P",value:Math.pow(1024,5),scientific:!0},E:{name:"E",value:Math.pow(1024,6),scientific:!0},Z:{name:"Z",value:Math.pow(1024,7),scientific:!0},Y:{name:"Y",value:Math.pow(1024,8),scientific:!0},Ki:{name:"Ki",value:1024,scientific:!0},Mi:{name:"Mi",value:Math.pow(1024,2),scientific:!0},Gi:{name:"Gi",value:Math.pow(1024,3),scientific:!0},Ti:{name:"Ti",value:Math.pow(1024,4),scientific:!0},Pi:{name:"Pi",value:Math.pow(1024,5),scientific:!0},Ei:{name:"Ei",value:Math.pow(1024,6),scientific:!0},Zi:{name:"Zi",value:Math.pow(1024,7),scientific:!0},Yi:{name:"Yi",value:Math.pow(1024,8),scientific:!0}},BINARY_LONG:{"":{name:"",value:1,scientific:!0},kilo:{name:"kilo",value:1024,scientific:!0},mega:{name:"mega",value:Math.pow(1024,2),scientific:!0},giga:{name:"giga",value:Math.pow(1024,3),scientific:!0},tera:{name:"tera",value:Math.pow(1024,4),scientific:!0},peta:{name:"peta",value:Math.pow(1024,5),scientific:!0},exa:{name:"exa",value:Math.pow(1024,6),scientific:!0},zetta:{name:"zetta",value:Math.pow(1024,7),scientific:!0},yotta:{name:"yotta",value:Math.pow(1024,8),scientific:!0},kibi:{name:"kibi",value:1024,scientific:!0},mebi:{name:"mebi",value:Math.pow(1024,2),scientific:!0},gibi:{name:"gibi",value:Math.pow(1024,3),scientific:!0},tebi:{name:"tebi",value:Math.pow(1024,4),scientific:!0},pebi:{name:"pebi",value:Math.pow(1024,5),scientific:!0},exi:{name:"exi",value:Math.pow(1024,6),scientific:!0},zebi:{name:"zebi",value:Math.pow(1024,7),scientific:!0},yobi:{name:"yobi",value:Math.pow(1024,8),scientific:!0}}},o.PREFIX_NONE={name:"",value:1,scientific:!0},o.BASE_UNITS={NONE:{},LENGTH:{},MASS:{},TIME:{},CURRENT:{},TEMPERATURE:{},LUMINOUS_INTENSITY:{},AMOUNT_OF_SUBSTANCE:{},FORCE:{},SURFACE:{},VOLUME:{},ANGLE:{},BIT:{}};var St=o.BASE_UNITS,_t=o.PREFIXES;o.BASE_UNIT_NONE={},o.UNIT_NONE={name:"",base:o.BASE_UNIT_NONE,value:1,offset:0},o.UNITS=[{name:"meter",base:St.LENGTH,prefixes:_t.LONG,value:1,offset:0},{name:"inch",base:St.LENGTH,prefixes:_t.NONE,value:.0254,offset:0},{name:"foot",base:St.LENGTH,prefixes:_t.NONE,value:.3048,offset:0},{name:"yard",base:St.LENGTH,prefixes:_t.NONE,value:.9144,offset:0},{name:"mile",base:St.LENGTH,prefixes:_t.NONE,value:1609.344,offset:0},{name:"link",base:St.LENGTH,prefixes:_t.NONE,value:.201168,offset:0},{name:"rod",base:St.LENGTH,prefixes:_t.NONE,value:5.02921,offset:0},{name:"chain",base:St.LENGTH,prefixes:_t.NONE,value:20.1168,offset:0},{name:"angstrom",base:St.LENGTH,prefixes:_t.NONE,value:1e-10,offset:0},{name:"m",base:St.LENGTH,prefixes:_t.SHORT,value:1,offset:0},{name:"ft",base:St.LENGTH,prefixes:_t.NONE,value:.3048,offset:0},{name:"yd",base:St.LENGTH,prefixes:_t.NONE,value:.9144,offset:0},{name:"mi",base:St.LENGTH,prefixes:_t.NONE,value:1609.344,offset:0},{name:"li",base:St.LENGTH,prefixes:_t.NONE,value:.201168,offset:0},{name:"rd",base:St.LENGTH,prefixes:_t.NONE,value:5.02921,offset:0},{name:"ch",base:St.LENGTH,prefixes:_t.NONE,value:20.1168,offset:0},{name:"mil",base:St.LENGTH,prefixes:_t.NONE,value:254e-7,offset:0},{name:"m2",base:St.SURFACE,prefixes:_t.SHORT,value:1,offset:0},{name:"sqin",base:St.SURFACE,prefixes:_t.NONE,value:64516e-8,offset:0},{name:"sqft",base:St.SURFACE,prefixes:_t.NONE,value:.09290304,offset:0},{name:"sqyd",base:St.SURFACE,prefixes:_t.NONE,value:.83612736,offset:0},{name:"sqmi",base:St.SURFACE,prefixes:_t.NONE,value:2589988.110336,offset:0},{name:"sqrd",base:St.SURFACE,prefixes:_t.NONE,value:25.29295,offset:0},{name:"sqch",base:St.SURFACE,prefixes:_t.NONE,value:404.6873,offset:0},{name:"sqmil",base:St.SURFACE,prefixes:_t.NONE,value:6.4516e-10,offset:0},{name:"m3",base:St.VOLUME,prefixes:_t.SHORT,value:1,offset:0},{name:"L",base:St.VOLUME,prefixes:_t.SHORT,value:.001,offset:0},{name:"litre",base:St.VOLUME,prefixes:_t.LONG,value:.001,offset:0},{name:"cuin",base:St.VOLUME,prefixes:_t.NONE,value:16387064e-12,offset:0},{name:"cuft",base:St.VOLUME,prefixes:_t.NONE,value:.028316846592,offset:0},{name:"cuyd",base:St.VOLUME,prefixes:_t.NONE,value:.764554857984,offset:0},{name:"teaspoon",base:St.VOLUME,prefixes:_t.NONE,value:5e-6,offset:0},{name:"tablespoon",base:St.VOLUME,prefixes:_t.NONE,value:15e-6,offset:0},{name:"minim",base:St.VOLUME,prefixes:_t.NONE,value:6.161152e-8,offset:0},{name:"fluiddram",base:St.VOLUME,prefixes:_t.NONE,value:36966911e-13,offset:0},{name:"fluidounce",base:St.VOLUME,prefixes:_t.NONE,value:2957353e-11,offset:0},{name:"gill",base:St.VOLUME,prefixes:_t.NONE,value:.0001182941,offset:0},{name:"cup",base:St.VOLUME,prefixes:_t.NONE,value:.0002365882,offset:0},{name:"pint",base:St.VOLUME,prefixes:_t.NONE,value:.0004731765,offset:0},{name:"quart",base:St.VOLUME,prefixes:_t.NONE,value:.0009463529,offset:0},{name:"gallon",base:St.VOLUME,prefixes:_t.NONE,value:.003785412,offset:0},{name:"beerbarrel",base:St.VOLUME,prefixes:_t.NONE,value:.1173478,offset:0},{name:"oilbarrel",base:St.VOLUME,prefixes:_t.NONE,value:.1589873,offset:0},{name:"hogshead",base:St.VOLUME,prefixes:_t.NONE,value:.238481,offset:0},{name:"fldr",base:St.VOLUME,prefixes:_t.NONE,value:36966911e-13,offset:0},{name:"floz",base:St.VOLUME,prefixes:_t.NONE,value:2957353e-11,offset:0},{name:"gi",base:St.VOLUME,prefixes:_t.NONE,value:.0001182941,offset:0},{name:"cp",base:St.VOLUME,prefixes:_t.NONE,value:.0002365882,offset:0},{name:"pt",base:St.VOLUME,prefixes:_t.NONE,value:.0004731765,offset:0},{name:"qt",base:St.VOLUME,prefixes:_t.NONE,value:.0009463529,offset:0},{name:"gal",base:St.VOLUME,prefixes:_t.NONE,value:.003785412,offset:0},{name:"bbl",base:St.VOLUME,prefixes:_t.NONE,value:.1173478,offset:0},{name:"obl",base:St.VOLUME,prefixes:_t.NONE,value:.1589873,offset:0},{name:"g",base:St.MASS,prefixes:_t.SHORT,value:.001,offset:0},{name:"gram",base:St.MASS,prefixes:_t.LONG,value:.001,offset:0},{name:"ton",base:St.MASS,prefixes:_t.SHORT,value:907.18474,offset:0},{name:"tonne",base:St.MASS,prefixes:_t.SHORT,value:1e3,offset:0},{name:"grain",base:St.MASS,prefixes:_t.NONE,value:6479891e-11,offset:0},{name:"dram",base:St.MASS,prefixes:_t.NONE,value:.0017718451953125,offset:0},{name:"ounce",base:St.MASS,prefixes:_t.NONE,value:.028349523125,offset:0},{name:"poundmass",base:St.MASS,prefixes:_t.NONE,value:.45359237,offset:0},{name:"hundredweight",base:St.MASS,prefixes:_t.NONE,value:45.359237,offset:0},{name:"stick",base:St.MASS,prefixes:_t.NONE,value:.115,offset:0},{name:"gr",base:St.MASS,prefixes:_t.NONE,value:6479891e-11,offset:0},{name:"dr",base:St.MASS,prefixes:_t.NONE,value:.0017718451953125,offset:0},{name:"oz",base:St.MASS,prefixes:_t.NONE,value:.028349523125,offset:0},{name:"lbm",base:St.MASS,prefixes:_t.NONE,value:.45359237,offset:0},{name:"cwt",base:St.MASS,prefixes:_t.NONE,value:45.359237,offset:0},{name:"s",base:St.TIME,prefixes:_t.SHORT,value:1,offset:0},{name:"min",base:St.TIME,prefixes:_t.NONE,value:60,offset:0},{name:"h",base:St.TIME,prefixes:_t.NONE,value:3600,offset:0},{name:"seconds",base:St.TIME,prefixes:_t.LONG,value:1,offset:0},{name:"second",base:St.TIME,prefixes:_t.LONG,value:1,offset:0},{name:"sec",base:St.TIME,prefixes:_t.LONG,value:1,offset:0},{name:"minutes",base:St.TIME,prefixes:_t.NONE,value:60,offset:0},{name:"minute",base:St.TIME,prefixes:_t.NONE,value:60,offset:0},{name:"hours",base:St.TIME,prefixes:_t.NONE,value:3600,offset:0},{name:"hour",base:St.TIME,prefixes:_t.NONE,value:3600,offset:0},{name:"day",base:St.TIME,prefixes:_t.NONE,value:86400,offset:0},{name:"days",base:St.TIME,prefixes:_t.NONE,value:86400,offset:0},{name:"rad",base:St.ANGLE,prefixes:_t.NONE,value:1,offset:0},{name:"deg",base:St.ANGLE,prefixes:_t.NONE,value:.017453292519943295,offset:0},{name:"grad",base:St.ANGLE,prefixes:_t.NONE,value:.015707963267948967,offset:0},{name:"cycle",base:St.ANGLE,prefixes:_t.NONE,value:6.283185307179586,offset:0},{name:"A",base:St.CURRENT,prefixes:_t.SHORT,value:1,offset:0},{name:"ampere",base:St.CURRENT,prefixes:_t.LONG,value:1,offset:0},{name:"K",base:St.TEMPERATURE,prefixes:_t.NONE,value:1,offset:0},{name:"degC",base:St.TEMPERATURE,prefixes:_t.NONE,value:1,offset:273.15},{name:"degF",base:St.TEMPERATURE,prefixes:_t.NONE,value:1/1.8,offset:459.67},{name:"degR",base:St.TEMPERATURE,prefixes:_t.NONE,value:1/1.8,offset:0},{name:"kelvin",base:St.TEMPERATURE,prefixes:_t.NONE,value:1,offset:0},{name:"celsius",base:St.TEMPERATURE,prefixes:_t.NONE,value:1,offset:273.15},{name:"fahrenheit",base:St.TEMPERATURE,prefixes:_t.NONE,value:1/1.8,offset:459.67},{name:"rankine",base:St.TEMPERATURE,prefixes:_t.NONE,value:1/1.8,offset:0},{name:"mol",base:St.AMOUNT_OF_SUBSTANCE,prefixes:_t.NONE,value:1,offset:0},{name:"mole",base:St.AMOUNT_OF_SUBSTANCE,prefixes:_t.NONE,value:1,offset:0},{name:"cd",base:St.LUMINOUS_INTENSITY,prefixes:_t.NONE,value:1,offset:0},{name:"candela",base:St.LUMINOUS_INTENSITY,prefixes:_t.NONE,value:1,offset:0},{name:"N",base:St.FORCE,prefixes:_t.SHORT,value:1,offset:0},{name:"newton",base:St.FORCE,prefixes:_t.LONG,value:1,offset:0},{name:"lbf",base:St.FORCE,prefixes:_t.NONE,value:4.4482216152605,offset:0},{name:"poundforce",base:St.FORCE,prefixes:_t.NONE,value:4.4482216152605,offset:0},{name:"b",base:St.BIT,prefixes:_t.BINARY_SHORT,value:1,offset:0},{name:"bits",base:St.BIT,prefixes:_t.BINARY_LONG,value:1,offset:0},{name:"B",base:St.BIT,prefixes:_t.BINARY_SHORT,value:8,offset:0},{name:"bytes",base:St.BIT,prefixes:_t.BINARY_LONG,value:8,offset:0}],Tt.Vector=s,s.prototype.resize=function(e,t){if(e=e.valueOf(),e instanceof Array){if(e.length>1)throw new RangeError("Cannot resize a vector to multiple dimensions (size: "+ct(e)+")");this.resize(e[0],t)}else{if(!r(e)||!n(e)||0>e)throw new TypeError("Positive integer expected as size in method resize");if(e>this._data.length)for(var i=this._data.length;e>i;i++)this._data[i]=t?ut(t):0;else this._data.length=e;this._size=[this._data.length]}},s.prototype.get=function(e){var a=this;if(e=e.valueOf(),e instanceof t){if(!e.isVector())throw new RangeError("Index must be a vector (size: "+ct(e.size())+")");e=e.toVector()}if(e instanceof s&&(e=e.valueOf()),e instanceof i||e instanceof Array)return e.map(function(e){return a.get(e)});if(!r(e)||!n(e)||0>e)throw new TypeError("Positive integer expected as index in method get");if(e>this._data.length-1)throw new RangeError("Index out of range ("+e+")");return this._data[e]},s.prototype.set=function(e,r){var n=this;if(e instanceof t){if(!e.isVector())throw new RangeError("Index must be a vector (size: "+ct(e.size())+")");e=e.toVector()}if(e instanceof s&&(e=e.valueOf()),(r instanceof t||r instanceof s||r instanceof i)&&(r=r.valueOf()),e instanceof i||e instanceof Array)if(r instanceof Array){if(H(e)!=r.length)throw new RangeError("Dimension mismatch ("+H(e)+" != "+r.length+")");e.forEach(function(e,t){n._set(e,r[t])})}else e.forEach(function(e){n._set(e,r)});else r instanceof Array?this.set([e],r):this._set(e,r)},s.prototype._set=function(e,t){e>this._data.length&&this.resize(e),this._data[e]=t},s.prototype.clone=function(){var e=new s;return e._data=ut(this._data),e},s.prototype.size=function(){return this._size},s.prototype.toScalar=function(){return 1==this._data.length?ut(this._data[0]):null},s.prototype.isScalar=function(){return 1>=this._data.length},s.prototype.toMatrix=function(){return new t(this.toArray())},s.prototype.toArray=function(){return ut(this._data)},s.prototype.valueOf=function(){return this._data},s.prototype.toString=function(){return At.formatArray(this._data)},Tt.E=Math.E,Tt.LN2=Math.LN2,Tt.LN10=Math.LN10,Tt.LOG2E=Math.LOG2E,Tt.LOG10E=Math.LOG10E,Tt.PI=Math.PI,Tt.SQRT1_2=Math.SQRT1_2,Tt.SQRT2=Math.SQRT2,Tt.I=new e(0,-1),Tt.pi=Tt.PI,Tt.e=Tt.E,Tt.i=Tt.I,Tt.abs=c,c.doc={name:"abs",category:"Arithmetic",syntax:["abs(x)"],description:"Compute the absolute value.",examples:["abs(3.5)","abs(-4.2)"],seealso:["sign"]},Tt.add=h,h.doc={name:"add",category:"Operators",syntax:["x + y","add(x, y)"],description:"Add two values.",examples:["2.1 + 3.6","ans - 3.6","3 + 2i",'"hello" + " world"',"3 cm + 2 inch"],seealso:["subtract"]},Tt.ceil=l,l.doc={name:"ceil",category:"Arithmetic",syntax:["ceil(x)"],description:"Round a value towards plus infinity.If x is complex, both real and imaginary part are rounded towards plus infinity.",examples:["ceil(3.2)","ceil(3.8)","ceil(-4.2)"],seealso:["floor","fix","round"]},Tt.cube=p,p.doc={name:"cube",category:"Arithmetic",syntax:["cube(x)"],description:"Compute the cube of a value. The cube of x is x * x * x.",examples:["cube(2)","2^3","2 * 2 * 2"],seealso:["multiply","square","pow"]},Tt.divide=m,m.doc={name:"divide",category:"Operators",syntax:["x / y","divide(x, y)"],description:"Divide two values.",examples:["2 / 3","ans * 3","4.5 / 2","3 + 4 / 2","(3 + 4) / 2","18 km / 4.5"],seealso:["multiply"]},Tt.equal=d,d.doc={name:"equal",category:"Operators",syntax:["x == y","equal(x, y)"],description:"Check equality of two values. Returns 1 if the values are equal, and 0 if not.",examples:["2+2 == 3","2+2 == 4","a = 3.2","b = 6-2.8","a == b","50cm == 0.5m"],seealso:["unequal","smaller","larger","smallereq","largereq"]},Tt.exp=g,g.doc={name:"exp",category:"Arithmetic",syntax:["exp(x)"],description:"Calculate the exponent of a value.",examples:["exp(1.3)","e ^ 1.3","log(exp(1.3))","x = 2.4","(exp(i*x) == cos(x) + i*sin(x))   # Euler's formula"],seealso:["square","multiply","log"]},Tt.fix=y,y.doc={name:"fix",category:"Arithmetic",syntax:["fix(x)"],description:"Round a value towards zero.If x is complex, both real and imaginary part are rounded towards zero.",examples:["fix(3.2)","fix(3.8)","fix(-4.2)","fix(-4.8)"],seealso:["ceil","floor","round"]},Tt.floor=x,x.doc={name:"floor",category:"Arithmetic",syntax:["floor(x)"],description:"Round a value towards minus infinity.If x is complex, both real and imaginary part are rounded towards minus infinity.",examples:["floor(3.2)","floor(3.8)","floor(-4.2)"],seealso:["ceil","fix","round"]},Tt.larger=w,w.doc={name:"larger",category:"Operators",syntax:["x > y","larger(x, y)"],description:"Check if value x is larger than y. Returns 1 if x is larger than y, and 0 if not.",examples:["2 > 3","5 > 2*2","a = 3.3","b = 6-2.8","(a > b)","(b < a)","5 cm > 2 inch"],seealso:["equal","unequal","smaller","smallereq","largereq"]},Tt.largereq=E,E.doc={name:"largereq",category:"Operators",syntax:["x >= y","largereq(x, y)"],description:"Check if value x is larger or equal to y. Returns 1 if x is larger or equal to y, and 0 if not.",examples:["2 > 1+1","2 >= 1+1","a = 3.2","b = 6-2.8","(a > b)"],seealso:["equal","unequal","smallereq","smaller","largereq"]},Tt.log=N,N.doc={name:"log",category:"Arithmetic",syntax:["log(x)","log(x, base)"],description:"Compute the logarithm of a value. If no base is provided, the natural logarithm of x is calculated. If base if provided, the logarithm is calculated for the specified base. log(x, base) is defined as log(x) / log(base).",examples:["log(3.5)","a = log(2.4)","exp(a)","10 ^ 3","log(1000, 10)","log(1000) / log(10)","b = logb(1024, 2)","2 ^ b"],seealso:["exp","log10"]},Tt.log10=O,O.doc={name:"log10",category:"Arithmetic",syntax:["log10(x)"],description:"Compute the 10-base logarithm of a value.",examples:["log10(1000)","10 ^ 3","log10(0.01)","log(1000) / log(10)","log(1000, 10)"],seealso:["exp","log"]},Tt.mod=b,b.doc={name:"mod",category:"Operators",syntax:["x % y","x mod y","mod(x, y)"],description:"Calculates the modulus, the remainder of an integer division.",examples:["7 % 3","11 % 2","10 mod 4","function isOdd(x) = x % 2","isOdd(2)","isOdd(3)"],seealso:[]},Tt.multiply=M,M.doc={name:"multiply",category:"Operators",syntax:["x * y","multiply(x, y)"],description:"multiply two values.",examples:["2.1 * 3.6","ans / 3.6","2 * 3 + 4","2 * (3 + 4)","3 * 2.1 km"],seealso:["divide"]},Tt.pow=A,A.doc={name:"pow",category:"Operators",syntax:["x ^ y","pow(x, y)"],description:"Calculates the power of x to y, x^y.",examples:["2^3 = 8","2*2*2","1 + e ^ (pi * i)"],seealso:["unequal","smaller","larger","smallereq","largereq"]},Tt.round=_,_.doc={name:"round",category:"Arithmetic",syntax:["round(x)","round(x, n)"],description:"round a value towards the nearest integer.If x is complex, both real and imaginary part are rounded towards the nearest integer. When n is specified, the value is rounded to n decimals.",examples:["round(3.2)","round(3.8)","round(-4.2)","round(-4.8)","round(pi, 3)","round(123.45678, 2)"],seealso:["ceil","floor","fix"]},Tt.sign=U,U.doc={name:"sign",category:"Arithmetic",syntax:["sign(x)"],description:"Compute the sign of a value. The sign of a value x is 1 when x>1, -1 when x<0, and 0 when x=0.",examples:["sign(3.5)","sign(-4.2)","sign(0)"],seealso:["abs"]},Tt.smaller=q,q.doc={name:"smaller",category:"Operators",syntax:["x < y","smaller(x, y)"],description:"Check if value x is smaller than value y. Returns 1 if x is smaller than y, and 0 if not.",examples:["2 < 3","5 < 2*2","a = 3.3","b = 6-2.8","(a < b)","5 cm < 2 inch"],seealso:["equal","unequal","larger","smallereq","largereq"]},Tt.smallereq=z,z.doc={name:"smallereq",category:"Operators",syntax:["x <= y","smallereq(x, y)"],description:"Check if value x is smaller or equal to value y. Returns 1 if x is smaller than y, and 0 if not.",examples:["2 < 1+1","2 <= 1+1","a = 3.2","b = 6-2.8","(a < b)"],seealso:["equal","unequal","larger","smaller","largereq"]},Tt.sqrt=L,L.doc={name:"sqrt",category:"Arithmetic",syntax:["sqrt(x)"],description:"Compute the square root value. If x = y * y, then y is the square root of x.",examples:["sqrt(25)","5 * 5","sqrt(-1)"],seealso:["square","multiply"]},Tt.square=R,R.doc={name:"square",category:"Arithmetic",syntax:["square(x)"],description:"Compute the square of a value. The square of x is x * x.",examples:["square(3)","sqrt(9)","3^2","3 * 3"],seealso:["multiply","pow","sqrt","cube"]},Tt.subtract=C,C.doc={name:"subtract",category:"Operators",syntax:["x - y","subtract(x, y)"],description:"subtract two values.",examples:["5.3 - 2","ans + 2","2/3 - 1/6","2 * 3 - 3","2.1 km - 500m"],seealso:["add"]},Tt.unaryminus=I,I.doc={name:"unaryminus",category:"Operators",syntax:["-x","unaryminus(x)"],description:"Inverse the sign of a value.",examples:["-4.5","-(-5.6)"],seealso:["add","subtract"]},Tt.unequal=P,P.doc={name:"unequal",category:"Operators",syntax:["x != y","unequal(x, y)"],description:"Check unequality of two values. Returns 1 if the values are unequal, and 0 if they are equal.",examples:["2+2 != 3","2+2 != 4","a = 3.2","b = 6-2.8","a != b","50cm != 0.5m","5 cm != 2 inch"],seealso:["equal","smaller","larger","smallereq","largereq"]},Tt.arg=V,V.doc={name:"arg",category:"Complex",syntax:["arg(x)"],description:"Compute the argument of a complex value. If x = a+bi, the argument is computed as atan2(b, a).",examples:["arg(2 + 2i)","atan2(3, 2)","arg(2 - 3i)"],seealso:["re","im","conj","abs"]},Tt.conj=B,B.doc={name:"conj",category:"Complex",syntax:["conj(x)"],description:"Compute the complex conjugate of a complex value. If x = a+bi, the complex conjugate is a-bi.",examples:["conj(2 + 3i)","conj(2 - 3i)","conj(-5.2i)"],seealso:["re","im","abs","arg"]},Tt.im=D,D.doc={name:"im",category:"Complex",syntax:["im(x)"],description:"Get the imaginary part of a complex number.",examples:["im(2 + 3i)","re(2 + 3i)","im(-5.2i)","im(2.4)"],seealso:["re","conj","abs","arg"]},Tt.re=G,G.doc={name:"re",category:"Complex",syntax:["re(x)"],description:"Get the real part of a complex number.",examples:["re(2 + 3i)","im(2 + 3i)","re(-5.2i)","re(2.4)"],seealso:["im","conj","abs","arg"]},Tt.diag=Y,Y.doc={name:"diag",category:"Matrix",syntax:["diag(x)","diag(x, k)"],description:"Create a diagonal matrix or retrieve the diagonal of a matrix. When x is a vector, a matrix with the vector values on the diagonal will be returned. When x is a matrix, a vector with the diagonal values of the matrix is returned.When k is provided, the k-th diagonal will be filled in or retrieved, if k is positive, the values are placed on the super diagonal. When k is negative, the values are placed on the sub diagonal.",examples:["diag(1:4)","diag(1:4, 1)","a = [1, 2, 3; 4, 5, 6; 7, 8, 9]","diag(a)"],seealso:["eye","ones","range","size","transpose","zeros"]},Tt.eye=F,F.doc={name:"eye",category:"Numerics",syntax:["eye(n)","eye(m, n)","eye([m, n])","eye"],description:"Returns the identity matrix with size m-by-n. The matrix has ones on the diagonal and zeros elsewhere.",examples:["eye(3)","eye(3, 5)","a = [1, 2, 3; 4, 5, 6]","eye(size(a))"],seealso:["diag","ones","range","size","transpose","zeros"]},Tt.ones=j,j.doc={name:"ones",category:"Numerics",syntax:["ones(n)","ones(m, n)","ones(m, n, p, ...)","ones([m, n])","ones([m, n, p, ...])","ones"],description:"Create a matrix containing ones.",examples:["ones(3)","ones(3, 5)","ones([2,3]) * 4.5","a = [1, 2, 3; 4, 5, 6]","ones(size(a))"],seealso:["diag","eye","range","size","transpose","zeros"]},Tt.size=H,H.doc={name:"size",category:"Numerics",syntax:["size(x)"],description:"Calculate the size of a matrix.",examples:["size(2.3)",'size("hello world")',"a = [1, 2; 3, 4; 5, 6]","size(a)","size(1:6)"],seealso:["diag","eye","ones","range","transpose","zeros"]},Tt.zeros=K,K.doc={name:"zeros",category:"Numerics",syntax:["zeros(n)","zeros(m, n)","zeros(m, n, p, ...)","zeros([m, n])","zeros([m, n, p, ...])","zeros"],description:"Create a matrix containing zeros.",examples:["zeros(3)","zeros(3, 5)","a = [1, 2, 3; 4, 5, 6]","zeros(size(a))"],seealso:["diag","eye","ones","range","size","transpose"]},Tt.factorial=W,W.doc={name:"factorial",category:"Probability",syntax:["x!","factorial(x)"],description:"Compute the factorial of a value",examples:["5!","5*4*3*2*1","3!"],seealso:[]},Tt.random=X,X.doc={name:"random",category:"Probability",syntax:["random()"],description:"Return a random number between 0 and 1.",examples:["random()","100 * random()"],seealso:[]},Tt.max=Z,Z.doc={name:"max",category:"Statistics",syntax:["max(a, b, c, ...)"],description:"Compute the maximum value of a list of values.",examples:["max(2, 3, 4, 1)","max(2.7, 7.1, -4.5, 2.0, 4.1)","min(2.7, 7.1, -4.5, 2.0, 4.1)"],seealso:["sum","prod","avg","var","std","min","median"]},Tt.min=Q,Q.doc={name:"min",category:"Statistics",syntax:["min(a, b, c, ...)"],description:"Compute the minimum value of a list of values.",examples:["max(2, 3, 4, 1)","max(2.7, 7.1, -4.5, 2.0, 4.1)","min(2.7, 7.1, -4.5, 2.0, 4.1)"],seealso:["sum","prod","avg","var","std","min","median"]},Tt.acos=J,J.doc={name:"acos",category:"Trigonometry",syntax:["acos(x)"],description:"Compute the inverse cosine of a value in radians.",examples:["acos(0.5)","acos(cos(2.3))"],seealso:["cos","acos","asin"]},Tt.asin=$,$.doc={name:"asin",category:"Trigonometry",syntax:["asin(x)"],description:"Compute the inverse sine of a value in radians.",examples:["asin(0.5)","asin(sin(2.3))"],seealso:["sin","acos","asin"]},Tt.atan=et,et.doc={name:"atan",category:"Trigonometry",syntax:["atan(x)"],description:"Compute the inverse tangent of a value in radians.",examples:["atan(0.5)","atan(tan(2.3))"],seealso:["tan","acos","asin"]},Tt.atan2=tt,tt.doc={name:"atan2",category:"Trigonometry",syntax:["atan2(y, x)"],description:"Computes the principal value of the arc tangent of y/x in radians.",examples:["atan2(2, 2) / pi","angle = 60 deg in rad","x = cos(angle)","y = sin(angle)","atan2(y, x)"],seealso:["sin","cos","tan"]},Tt.cos=rt,rt.doc={name:"cos",category:"Trigonometry",syntax:["cos(x)"],description:"Compute the cosine of x in radians.",examples:["cos(2)","cos(pi / 4) ^ 2","cos(180 deg)","cos(60 deg)","sin(0.2)^2 + cos(0.2)^2"],seealso:["acos","sin","tan"]},Tt.cot=nt,nt.doc={name:"cot",category:"Trigonometry",syntax:["cot(x)"],description:"Compute the cotangent of x in radians. Defined as 1/tan(x)",examples:["cot(2)","1 / tan(2)"],seealso:["sec","csc","tan"]},Tt.csc=it,it.doc={name:"csc",category:"Trigonometry",syntax:["csc(x)"],description:"Compute the cosecant of x in radians. Defined as 1/sin(x)",examples:["csc(2)","1 / sin(2)"],seealso:["sec","cot","sin"]},Tt.sec=at,at.doc={name:"sec",category:"Trigonometry",syntax:["sec(x)"],description:"Compute the secant of x in radians. Defined as 1/cos(x)",examples:["sec(2)","1 / cos(2)"],seealso:["cot","csc","cos"]},Tt.sin=ot,ot.doc={name:"sin",category:"Trigonometry",syntax:["sin(x)"],description:"Compute the sine of x in radians.",examples:["sin(2)","sin(pi / 4) ^ 2","sin(90 deg)","sin(30 deg)","sin(0.2)^2 + cos(0.2)^2"],seealso:["asin","cos","tan"]},Tt.tan=st,st.doc={name:"tan",category:"Trigonometry",syntax:["tan(x)"],description:"Compute the tangent of x in radians.",examples:["tan(0.5)","sin(0.5) / cos(0.5)","tan(pi / 4)","tan(45 deg)"],seealso:["atan","sin","cos"]},Tt.in=ft,ft.doc={name:"in",category:"Units",syntax:["x in unit","in(x, unit)"],description:"Change the unit of a value.",examples:["5 inch in cm","3.2kg in g","16 bytes in bits"],seealso:[]},Tt.clone=ut,ut.doc={name:"clone",category:"Utils",syntax:["clone(x)"],description:"Clone a variable. Creates a copy of primitive variables,and a deep copy of matrices",examples:["clone(3.5)","clone(2 - 4i)","clone(45 deg)","clone([1, 2; 3, 4])",'clone("hello world")'],seealso:[]},Tt.format=ct,ct.doc={name:"format",category:"Utils",syntax:["format(value)"],description:"Format a value of any type as string.",examples:["format(2.3)","format(3 - 4i)","format([])"],seealso:[]},Tt.help=ht,ht.doc={name:"help",category:"Utils",syntax:["help(object)"],description:"Display documentation on a function or data type.",examples:['help("sqrt")','help("Complex")'],seealso:[]},Tt["import"]=pt,pt.doc={name:"import",category:"Utils",syntax:["import(string)"],description:"Import functions from a file.",examples:['import("numbers")','import("./mylib.js")'],seealso:[]},Tt["typeof"]=vt,vt.doc={name:"typeof",category:"Utils",syntax:["typeof(x)"],description:"Get the type of a variable.",examples:["typeof(3.5)","typeof(2 - 4i)","typeof(45 deg)",'typeof("hello world")'],seealso:[]},Tt.parser.node.Node=dt,dt.prototype.eval=function(){throw Error("Cannot evaluate a Node interface")
},dt.prototype.toString=function(){return""},gt.prototype=new dt,Tt.parser.node.Symbol=gt,gt.prototype.hasParams=function(){return void 0!=this.params&&this.params.length>0},gt.prototype.eval=function(){var e=this.fn;if(void 0===e)throw Error("Undefined symbol "+this.name);var t=this.params.map(function(e){return e.eval()});return e.apply(this,t)},gt.prototype.toString=function(){if(this.name&&!this.params)return this.name;var e=this.name;return this.params&&this.params.length&&(e+="("+this.params.join(", ")+")"),e},yt.prototype=new dt,Tt.parser.node.Constant=yt,yt.prototype.eval=function(){return this.value},yt.prototype.toString=function(){return this.value?Tt.format(this.value):""},xt.prototype=new dt,Tt.parser.node.MatrixNode=xt,function(){function e(t){return t.map(function(t){return t instanceof Array?e(t):t.eval()})}function r(e){if(e instanceof Array){for(var t="[",n=e.length,i=0;n>i;i++)0!=i&&(t+=", "),t+=r(e[i]);return t+="]"}return""+e}xt.prototype.eval=function(){return new t(e(this.nodes))},xt.prototype.toString=function(){return r(this.nodes)}}(),wt.prototype=new dt,Tt.parser.node.Block=wt,wt.prototype.add=function(e,t){var r=this.params.length;this.params[r]=e,this.visible[r]=void 0!=t?t:!0},wt.prototype.eval=function(){for(var e=[],t=0,r=this.params.length;r>t;t++){var n=this.params[t].eval();this.visible[t]&&e.push(n)}return e},wt.prototype.toString=function(){for(var e=[],t=0,r=this.params.length;r>t;t++)this.visible[t]&&e.push("\n  "+(""+this.params[t]));return"["+e.join(",")+"\n]"},Et.prototype=new dt,Tt.parser.node.Assignment=Et,Et.prototype.eval=function(){if(void 0===this.expr)throw Error("Undefined symbol "+this.name);var e,t=this.params;if(t&&t.length){var r=[];this.params.forEach(function(e){r.push(e.eval())});var n=this.expr.eval();if(void 0==this.result.value)throw Error("Undefined symbol "+this.name);var i=this.result.eval();e=i.set(r,n),this.result.value=e}else e=this.expr.eval(),this.result.value=e;return e},Et.prototype.toString=function(){var e="";return e+=this.name,this.params&&this.params.length&&(e+="("+this.params.join(", ")+")"),e+=" = ",e+=""+this.expr},Nt.prototype=new dt,Tt.parser.node.FunctionAssignment=Nt,Nt.prototype.createFunction=function(e,t,r,n){var i=function(){var t=r?r.length:0,i=arguments?arguments.length:0;if(t!=i)throw u(e,i,t);if(t>0)for(var a=0;t>a;a++)r[a].value=arguments[a];return n.eval()};return i.toString=function(){return e+"("+t.join(", ")+")"},i},Nt.prototype.eval=function(){for(var e=this.variables,t=this.values,r=0,n=e.length;n>r;r++)e[r].value=t[r];return this.result.value=this.def,this.def},Nt.prototype.toString=function(){return""+this.def},Tt.parser.node.Scope=Ot,Ot.prototype.createNestedScope=function(){var e=new Ot(this);return this.nestedScopes||(this.nestedScopes=[]),this.nestedScopes.push(e),e},Ot.prototype.clear=function(){if(this.symbols={},this.defs={},this.links={},this.updates={},this.nestedScopes)for(var e=this.nestedScopes,t=0,r=e.length;r>t;t++)e[t].clear()},Ot.prototype.createSymbol=function(e){var t=this.symbols[e];if(!t){var r=this.findDef(e);t=this.newSymbol(e,r),this.symbols[e]=t}return t},Ot.prototype.newSymbol=function(e,t){var r=this,n=function(){if(!n.value&&(n.value=r.findDef(e),!n.value))throw Error("Undefined symbol "+e);return"function"==typeof n.value?n.value.apply(null,arguments):n.value};return n.value=t,n.toString=function(){return n.value?""+n.value:""},n},Ot.prototype.createLink=function(e){var t=this.links[e];return t||(t=this.createSymbol(e),this.links[e]=t),t},Ot.prototype.createDef=function(e,t){var r=this.defs[e];return r||(r=this.createSymbol(e),this.defs[e]=r),r&&void 0!=t&&(r.value=t),r},Ot.prototype.createUpdate=function(e){var t=this.updates[e];return t||(t=this.createLink(e),this.updates[e]=t),t},Ot.prototype.findDef=function(t){function r(e,t){var r=i(e,t);return a[e]=r,s[e]=r,r}var n;if(n=this.defs[t])return n;if(n=this.updates[t])return n;if(this.parentScope)return this.parentScope.findDef(t);var i=this.newSymbol,a=this.symbols,s=this.defs;if("pi"==t)return r(t,Tt.PI);if("e"==t)return r(t,Tt.E);if("i"==t)return r(t,new e(0,1));var f=Tt[t];if(f)return r(t,f);if(o.isUnit(t)){var u=new o(null,t);return r(t,u)}return void 0},Ot.prototype.removeLink=function(e){delete this.links[e]},Ot.prototype.removeDef=function(e){delete this.defs[e]},Ot.prototype.removeUpdate=function(e){delete this.updates[e]},Ot.prototype.init=function(){var e=this.symbols,t=this.parentScope;for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];n.value=t?t.findDef(r):void 0}this.nestedScopes&&this.nestedScopes.forEach(function(e){e.init()})},Ot.prototype.hasLink=function(e){if(this.links[e])return!0;if(this.nestedScopes)for(var t=this.nestedScopes,r=0,n=t.length;n>r;r++)if(t[r].hasLink(e))return!0;return!1},Ot.prototype.hasDef=function(e){return void 0!=this.defs[e]},Ot.prototype.hasUpdate=function(e){return void 0!=this.updates[e]},Ot.prototype.getUndefinedSymbols=function(){var e=this.symbols,t=[];for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];void 0==n.value&&t.push(n)}return this.nestedScopes&&this.nestedScopes.forEach(function(e){t=t.concat(e.getUndefinedSymbols())}),t},Tt.parser.Parser=bt,bt.prototype.parse=function(e,t){return this.expr=e||"",t||(this.newScope(),t=this.scope),this.parse_start(t)},bt.prototype.eval=function(e){var t=this.parse(e);return t.eval()},bt.prototype.get=function(e){this.newScope();var t=this.scope.findDef(e);return t?t.value:void 0},bt.prototype.set=function(e,t){this.scope.createDef(e,t)},bt.prototype.newScope=function(){this.scope=new Ot(this.scope)},bt.prototype.clear=function(){this.scope.clear()},bt.prototype.getChar=function(){this.index++,this.c=this.expr.charAt(this.index)},bt.prototype.getFirstChar=function(){this.index=0,this.c=this.expr.charAt(0)},bt.prototype.getToken=function(){for(this.token_type=this.TOKENTYPE.NULL,this.token="";" "==this.c||"	"==this.c;)this.getChar();if("#"==this.c)for(;"\n"!=this.c&&""!=this.c;)this.getChar();if(""==this.c)return this.token_type=this.TOKENTYPE.DELIMITER,void 0;if("-"==this.c||","==this.c||"("==this.c||")"==this.c||"["==this.c||"]"==this.c||'"'==this.c||"\n"==this.c||";"==this.c||":"==this.c)return this.token_type=this.TOKENTYPE.DELIMITER,this.token+=this.c,this.getChar(),void 0;if(this.isDelimiter(this.c))for(this.token_type=this.TOKENTYPE.DELIMITER;this.isDelimiter(this.c);)this.token+=this.c,this.getChar();else if(this.isDigitDot(this.c)){for(this.token_type=this.TOKENTYPE.NUMBER;this.isDigitDot(this.c);)this.token+=this.c,this.getChar();if("E"==this.c||"e"==this.c)for(this.token+=this.c,this.getChar(),("+"==this.c||"-"==this.c)&&(this.token+=this.c,this.getChar()),this.isDigit(this.c)||(this.token_type=this.TOKENTYPE.UNKNOWN);this.isDigit(this.c);)this.token+=this.c,this.getChar()}else{if(!this.isAlpha(this.c)){for(this.token_type=this.TOKENTYPE.UNKNOWN;""!=this.c;)this.token+=this.c,this.getChar();throw this.createSyntaxError('Syntax error in part "'+this.token+'"')}for(this.token_type=this.TOKENTYPE.SYMBOL;this.isAlpha(this.c)||this.isDigit(this.c);)this.token+=this.c,this.getChar()}},bt.prototype.isDelimiter=function(e){return"&"==e||"|"==e||"<"==e||">"==e||"="==e||"+"==e||"/"==e||"*"==e||"%"==e||"^"==e||","==e||";"==e||"\n"==e||"!"==e},bt.prototype.isValidSymbolName=function(e){for(var t=0,r=e.length;r>t;t++){var n=e.charAt(t),i=this.isAlpha(n);if(!i)return!1}return!0},bt.prototype.isAlpha=function(e){return e>="a"&&"z">=e||e>="A"&&"Z">=e||"_"==e},bt.prototype.isDigitDot=function(e){return e>="0"&&"9">=e||"."==e},bt.prototype.isDigit=function(e){return e>="0"&&"9">=e},bt.prototype.parse_start=function(e){this.getFirstChar(),this.getToken();var t;if(t=""==this.token?new yt(void 0):this.parse_block(e),""!=this.token)throw this.token_type==this.TOKENTYPE.DELIMITER?this.createError("Unknown operator "+this.token):this.createSyntaxError('Unexpected part "'+this.token+'"');return t},bt.prototype.parse_ans=function(e){var t=this.parse_function_assignment(e);if(!(t instanceof Et)){var r="ans",n=void 0,i=e.createDef(r);return new Et(r,n,t,i)}return t},bt.prototype.parse_block=function(e){var t,r,n;for("\n"!=this.token&&";"!=this.token&&""!=this.token&&(t=this.parse_ans(e));"\n"==this.token||";"==this.token;)r||(r=new wt,t&&(n=";"!=this.token,r.add(t,n))),this.getToken(),"\n"!=this.token&&";"!=this.token&&""!=this.token&&(t=this.parse_ans(e),n=";"!=this.token,r.add(t,n));return r?r:(t||(t=this.parse_ans(e)),t)},bt.prototype.parse_function_assignment=function(e){if(this.token_type==this.TOKENTYPE.SYMBOL&&"function"==this.token){if(this.getToken(),this.token_type!=this.TOKENTYPE.SYMBOL)throw this.createSyntaxError("Function name expected");var t=this.token;if(this.getToken(),"("!=this.token)throw this.createSyntaxError("Opening parenthesis ( expected");for(var r=e.createNestedScope(),n=[],i=[];;){if(this.getToken(),this.token_type!=this.TOKENTYPE.SYMBOL)throw this.createSyntaxError("Variable name expected");var a=this.token,o=r.createDef(a);if(n.push(a),i.push(o),this.getToken(),","!=this.token){if(")"==this.token)break;throw this.createSyntaxError('Comma , or closing parenthesis ) expected"')}}if(this.getToken(),"="!=this.token)throw this.createSyntaxError("Equal sign = expected");this.getToken();var s=this.parse_range(r),f=e.createDef(t);return new Nt(t,n,i,s,f)}return this.parse_assignment(e)},bt.prototype.parse_assignment=function(e){var t=!1;this.token_type==this.TOKENTYPE.SYMBOL&&(t=e.hasLink(this.token));var r=this.parse_range(e);if("="==this.token){if(!(r instanceof gt))throw this.createSyntaxError("Symbol expected at the left hand side of assignment operator =");var n=r.name,i=r.params;t||e.removeLink(n),this.getToken();var a=this.parse_range(e),o=r.hasParams()?e.createUpdate(n):e.createDef(n);return new Et(n,i,a,o)}return r},bt.prototype.parse_range=function(e){var t=this.parse_conditions(e);if(":"==this.token){for(var r=[t];":"==this.token;)this.getToken(),r.push(this.parse_conditions(e));if(r.length>3)throw new TypeError("Invalid range");var n="range",a=function(e,t,r){return new i(e,t,r)};t=new gt(n,a,r)}return t},bt.prototype.parse_conditions=function(e){for(var t=this.parse_bitwise_conditions(e),r={"in":"in"};void 0!==r[this.token];){var n=this.token,i=Tt[r[n]];this.getToken();var a=[t,this.parse_bitwise_conditions(e)];t=new gt(n,i,a)}return t},bt.prototype.parse_bitwise_conditions=function(e){var t=this.parse_comparison(e);return t},bt.prototype.parse_comparison=function(e){for(var t=this.parse_addsubtract(e),r={"==":"equal","!=":"unequal","<":"smaller",">":"larger","<=":"smallereq",">=":"largereq"};void 0!==r[this.token];){var n=this.token,i=Tt[r[n]];this.getToken();var a=[t,this.parse_addsubtract(e)];t=new gt(n,i,a)}return t},bt.prototype.parse_addsubtract=function(e){for(var t=this.parse_multiplydivide(e),r={"+":"add","-":"subtract"};void 0!==r[this.token];){var n=this.token,i=Tt[r[n]];this.getToken();var a=[t,this.parse_multiplydivide(e)];t=new gt(n,i,a)}return t},bt.prototype.parse_multiplydivide=function(e){for(var t=this.parse_unaryminus(e),r={"*":"multiply","/":"divide","%":"mod",mod:"mod"};void 0!==r[this.token];){var n=this.token,i=Tt[r[n]];this.getToken();var a=[t,this.parse_unaryminus(e)];t=new gt(n,i,a)}return t},bt.prototype.parse_unaryminus=function(e){if("-"==this.token){var t=this.token,r=I;this.getToken();var n=[this.parse_pow(e)];return new gt(t,r,n)}return this.parse_pow(e)},bt.prototype.parse_pow=function(e){for(var t=[this.parse_factorial(e)];"^"==this.token;)this.getToken(),t.push(this.parse_factorial(e));for(var r=t.pop();t.length;){var n=t.pop(),i="^",a=A,o=[n,r];r=new gt(i,a,o)}return r},bt.prototype.parse_factorial=function(e){for(var t=this.parse_plot(e);"!"==this.token;){var r=this.token,n=W;this.getToken();var i=[t];t=new gt(r,n,i)}return t},bt.prototype.parse_plot=function(e){return this.parse_symbol(e)},bt.prototype.parse_symbol=function(e){if(this.token_type==this.TOKENTYPE.SYMBOL){var t=this.token;this.getToken();var r=e.createLink(t),n=this.parse_arguments(e),i=new gt(t,r,n);return i}return this.parse_string(e)},bt.prototype.parse_arguments=function(e){var t=[];if("("==this.token){if(this.getToken(),")"!=this.token)for(t.push(this.parse_range(e));","==this.token;)this.getToken(),t.push(this.parse_range(e));if(")"!=this.token)throw this.createSyntaxError("Parenthesis ) missing");this.getToken()}return t},bt.prototype.parse_string=function(e){if('"'==this.token){for(var t="",r="";""!=this.c&&('"'!=this.c||"\\"==r);)t+=this.c,r=this.c,this.getChar();if(this.getToken(),'"'!=this.token)throw this.createSyntaxError('End of string " missing');this.getToken();var n=new yt(t);return n}return this.parse_matrix(e)},bt.prototype.parse_matrix=function(e){if("["==this.token){var t;for(this.getToken();"\n"==this.token;)this.getToken();if("]"!=this.token){var r=[],n=0,i=0;for(r[0]=[this.parse_range(e)];","==this.token||";"==this.token;){for(","==this.token?i++:(n++,i=0,r[n]=[]),this.getToken();"\n"==this.token;)this.getToken();for(r[n][i]=this.parse_range(e);"\n"==this.token;)this.getToken()}var a=r.length,o=r.length>0?r[0].length:0;for(n=1;a>n;n++)if(r[n].length!=o)throw this.createError("Number of columns must match ("+r[n].length+" != "+o+")");if("]"!=this.token)throw this.createSyntaxError("End of matrix ] missing");this.getToken(),t=new xt(r)}else this.getToken(),t=new xt([]);for(;"("==this.token;)t=this.parse_arguments(e,t);return t}return this.parse_number(e)},bt.prototype.parse_number=function(t){if(this.token_type==this.TOKENTYPE.NUMBER){var r;r="."==this.token?0:Number(this.token),this.getToken();var n;if(this.token_type==this.TOKENTYPE.SYMBOL){if("i"==this.token||"I"==this.token)return n=new e(0,r),this.getToken(),new yt(n);if(o.isUnit(this.token))return n=new o(r,this.token),this.getToken(),new yt(n);throw this.createTypeError('Unknown unit "'+this.token+'"')}var i=new yt(r);return i}return this.parse_parentheses(t)},bt.prototype.parse_parentheses=function(e){if("("==this.token){this.getToken();var t=this.parse_range(e);if(")"!=this.token)throw this.createSyntaxError("Parenthesis ) expected");return this.getToken(),t}return this.parse_end(e)},bt.prototype.parse_end=function(){throw""==this.token?this.createSyntaxError("Unexpected end of expression"):this.createSyntaxError("Value expected")},bt.prototype.row=function(){return void 0},bt.prototype.col=function(){return this.index-this.token.length+1},bt.prototype.createErrorMessage=function(e){var t=this.row(),r=this.col();return void 0===t?void 0===r?e:e+" (col "+r+")":e+" (ln "+t+", col "+r+")"},bt.prototype.createSyntaxError=function(e){return new SyntaxError(this.createErrorMessage(e))},bt.prototype.createTypeError=function(e){return new TypeError(this.createErrorMessage(e))},bt.prototype.createError=function(e){return Error(this.createErrorMessage(e))},Tt.parser.Workspace=Mt,Mt.prototype.clear=function(){this.nodes={},this.firstNode=void 0,this.lastNode=void 0},Mt.prototype.append=function(e){var t=this._getNewId(),r=this.lastNode?this.lastNode.scope:this.scope,n=new Ot(r),i=new Mt.Node({id:t,expression:e,parser:this.parser,scope:n,nextNode:void 0,previousNode:this.lastNode});return this.nodes[t]=i,this.firstNode||(this.firstNode=i),this.lastNode&&(this.lastNode.nextNode=i),this.lastNode=i,this._update([t]),t},Mt.prototype.insertBefore=function(e,t){var r=this.nodes[t];if(!r)throw'Node with id "'+t+'" not found';var n=r.previousNode,i=this._getNewId(),a=n?n.scope:this.scope,o=new Ot(a),s=new Mt.Node({id:i,expression:e,parser:this.parser,scope:o,nextNode:r,previousNode:n});this.nodes[i]=s,n?n.nextNode=s:this.firstNode=s,r.previousNode=s,r.scope.parentScope=s.scope;var f=this.getDependencies(i);return-1==f.indexOf(i)&&f.unshift(i),this._update(f),i},Mt.prototype.insertAfter=function(e,t){var r=this.nodes[t];if(!r)throw'Node with id "'+t+'" not found';return r==this.lastNode?this.append(e):this.insertBefore(t+1,e)},Mt.prototype.remove=function(e){var t=this.nodes[e];if(!t)throw'Node with id "'+e+'" not found';var r=this.getDependencies(e),n=t.previousNode,i=t.nextNode;n?n.nextNode=i:this.firstNode=i,i?i.previousNode=n:this.lastNode=n;var a=n?n.scope:this.scope;i&&(i.scope.parentScope=a),delete this.nodes[e],this._update(r)},Mt.prototype.replace=function(e,t){var r=this.nodes[t];if(!r)throw'Node with id "'+t+'" not found';var n=[t];Mt._merge(n,this.getDependencies(t));var i=r.previousNode;r.nextNode,i?i.scope:this.scope,r.setExpr(e),Mt._merge(n,this.getDependencies(t)),this._update(n)},Mt.Node=function(e){this.id=e.id,this.parser=e.parser,this.scope=e.scope,this.nextNode=e.nextNode,this.previousNode=e.previousNode,this.updateSeq=0,this.result=void 0,this.setExpr(e.expression)},Mt.Node.prototype.setExpr=function(e){this.expression=e||"",this.scope.clear(),this._parse()},Mt.Node.prototype.getExpr=function(){return this.expression},Mt.Node.prototype.getResult=function(){return this.result},Mt.Node.prototype._parse=function(){try{this.fn=this.parser.parse(this.expression,this.scope)}catch(e){var t="Error: "+((e.message||e)+"");this.fn=new yt(t)}},Mt.Node.prototype.eval=function(){try{this.scope.init(),this.result=this.fn.eval()}catch(e){this.scope.init(),this.result="Error: "+((e.message||e)+"")}return this.result},Mt._merge=function(e,t){for(var r=0,n=t.length;n>r;r++){var i=t[r];-1==e.indexOf(i)&&e.push(i)}},Mt.prototype.getDependencies=function(e){var t,r=[],n=this.nodes[e];if(n){var i=n.scope.defs,a=n.scope.updates,o=[];for(t in i)i.hasOwnProperty(t)&&o.push(t);for(t in a)a.hasOwnProperty(t)&&-1==o.indexOf(t)&&o.push(t);for(var s=n.nextNode;s&&o.length;){for(var f=s.scope,u=0;o.length>u;){if(t=o[u],(f.hasLink(t)||f.hasUpdate(t))&&-1==r.indexOf(s.id)){r.push(s.id);var c=this.getDependencies(s.id);Mt._merge(r,c)}f.hasDef(t)&&(o.splice(u,1),u--),u++}s=s.nextNode}}return r},Mt.prototype.getExpr=function(e){var t=this.nodes[e];if(!t)throw'Node with id "'+e+'" not found';return t.getExpr()},Mt.prototype.getResult=function(e){var t=this.nodes[e];if(!t)throw'Node with id "'+e+'" not found';return t.getResult()},Mt.prototype._update=function(e){this.updateSeq++;for(var t=this.updateSeq,r=this.nodes,n=0,i=e.length;i>n;n++){var a=e[n],o=r[a];o&&(o.eval(),o.updateSeq=t)}},Mt.prototype.getChanges=function(e){var t=[],r=this.firstNode;for(e=e||0;r;)r.updateSeq>e&&t.push(r.id),r=r.nextNode;return{ids:t,updateSeq:this.updateSeq}},Mt.prototype._getNewId=function(){return this.idMax++,this.idMax},Mt.prototype.toString=function(){return JSON.stringify(this.toJSON())},Mt.prototype.toJSON=function(){for(var e=[],t=this.firstNode;t;){var r={id:t.id,expression:t.expression,dependencies:this.getDependencies(t.id)};try{r.result=t.getResult()}catch(n){r.result="Error: "+((n.message||n)+"")}e.push(r),t=t.nextNode}return e}})();